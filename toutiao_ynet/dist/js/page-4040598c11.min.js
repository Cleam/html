$(function(){function e(){var e=GLOBAL.Util.getQueryString("type"),a=e?e:wsCache.get("current_newstype");this.newsType=a?a:"toutiao",this.readUrl="",this.userId=Cookies.get("user_id"),this.idx=0,this.pgNum=1,this.pulldown_pgNum=0,this.pulldown_idx=0,this.pulldown_num=0,this.toType=GLOBAL.Util.getQueryString("type"),this.qid=GLOBAL.Et.qid||GLOBAL.Util.getQueryString("qid")||Cookies.get("qid"),this.pullUpFlag=!0,this.startKey={},this.endKey={},this.osType=GLOBAL.Util.getOsType(),this.browserType=GLOBAL.Util.getBrowserType(),this.init()}FastClick.attach(document.body);var a="http://m.toutiao.ynet.com/data/channels.json",t="http://106.75.20.245/wapjson_h5/RefreshJP",s="http://106.75.20.245/wapjson_h5/pulldown",i="http://106.75.20.245/wapjson_h5/NextJP",n="http://106.75.21.113/wapdata/data",r="http://106.75.21.115/online/online",o="http://106.75.21.113/wapdata/ggshow",l="http://106.75.21.113/wapdata/ggclk",d="http://toutiao.eastday.com/getwapdata/videoact",c="http://position.dfshurufa.com/position/get",p="http://toutiao.eastday.com/getwapdata/getuid",u="http://toutiao.eastday.com/pjson/zan",g=$("body"),m=[],h=[],w=$("#J_news_list"),f=$("#J_refresh"),y=$("#J_top_menu");$("#J_gg_baidu_id"),$("#J_gg_sogou_id");praiseTrampleFlag=!0,startPos=0,touchDistance=0,touchDistanceFlag=!0,isSwipeDown=!1,isTop=!1,$pullDownLoading=null,TOUCH_DISTANCE=150,pullDownLoadDataTimer=null,wsCache=new WebStorageCache,videoHtmlIframe='<iframe name="iframe" src="gg/gg_video.html" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" width="100%" height="100%"></iframe>',baiduHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_baidu.html" frameborder="0" scrolling="no" width="100%" height="120"></iframe></div>',sogouHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_sogou.html" frameborder="0" scrolling="no" width="100%" height="78"></iframe></div>',e.prototype={init:function(){function e(e,t,s){var i=e.data("rowkey"),n=a.getPraiseTrampleStatus(i);return 1===n?void alert("您已经赞过了！"):-1===n?void alert("您已经踩过了！"):void(praiseTrampleFlag&&(praiseTrampleFlag=!1,e.addClass("active").text(Number(e.text())+1),$.ajax({url:u,dataType:"jsonp",data:{colname:t,rowkey:i,praisecnt:1},jsonp:"jsonpcallback",success:function(e){a.cachePraiseTrampleRowkey(s,i),praiseTrampleFlag=!0},error:function(e){console.error(e)}})))}var a=this;a.setGgId(),a.qid?a.setQid(a.qid):Cookies.remove("qid",{path:"/",domain:"eastday.com"}),a.userId||(a.userId=+new Date+Math.random().toString(10).substring(2,6),Cookies.set("user_id",a.userId,{expires:365,path:"/",domain:"eastday.com"})),a.readUrl=wsCache.get("read_url_all"),a.readUrl||(a.readUrl=""),a.initChannels(function(){var e=y.children("a");e.each(function(){var e=$(this),a=e.data("type");m.push(a),"meinv"!==a&&"nuanwen"!==a&&h.push(a)}),e.each(function(){var e=$(this);return e.data("type")==a.newsType?(setTimeout(function(){a.scrollTo(e,!1)},50),!1):void 0})}),a.refreshData(function(){a.highlightPraiseTrample()}),a.addLog(),a.pullDown(),y.on("tap","a",function(){var e=$(this),t=e.data("type");e.hasClass("active")||(a.scrollTo(e,!1),wsCache.set("prev_newstype",a.newsType,{exp:1200}),wsCache.set("current_newstype",t,{exp:1200}),a.newsType=t,a.refreshData(function(){a.highlightPraiseTrample()}),a.addLog())}),$(window).on("scroll",function(){var e=GLOBAL.Util.getScrollTop(),t=$("#J_loading").offset().top,s=GLOBAL.Util.getClientHeight(),i=null;i&&clearTimeout(i),i=setTimeout(function(){wsCache.set("news_pos_"+a.newsType,e,{exp:1200})},200),t>=s&&e+s>=t&&a.pullUpFlag&&a.pullUpLoadData(),w.find("video").each(function(){var e=$(this),a=e.offset().top,t=g.scrollTop();(t>=a||a-t>=$(window).height()-e.height())&&(this.paused||this.pause())})}),f.on("tap",function(){f.hasClass("active")||(a.changeRefreshStatus(),wsCache["delete"]("news_pos_"+a.newsType),wsCache["delete"]("news_"+a.newsType),wsCache.set("pulldown_pgnum_"+a.newsType,0,{exp:86400}),a.refreshData(function(){a.highlightPraiseTrample()}))}),w.on("click","a",function(e){var t=$(this),s=t.attr("href");s=s.substring(s.indexOf("/mobile/")+8,s.indexOf(".html")),a.cacheReadUrl(s,t.data("type"),t.data("subtype")),w.find("video").each(function(){this.paused||this.pause()})}),g.on("click",".J-read-position",function(){g.scrollTop(0),a.changeRefreshStatus(),a.pullDownLoadData()}),g.on("click",".J-promote-news",function(){var e=$(this),t=e.attr("href"),s=e.data("advid");a.sendPromoteNewslog(t,s)}),w.on("click",".J-good",function(){e($(this),"z0000",1)}),w.on("click",".J-bad",function(){e($(this),"zd0000",-1)}),a.addOnlineLog(),setInterval(function(){a.addOnlineLog()},1e4)},changeRefreshStatus:function(){f.addClass("active"),setTimeout(function(){f.removeClass("active")},700)},initChannels:function(e){var t=this,s=wsCache.get("news_channels");s?(t.generateChannelTabs(s),e&&e()):$.ajax({url:a,dataType:"json",success:function(a){t.generateChannelTabs(a.channels.up),e&&e()},error:function(){console.error(arguments)}})},sendPromoteNewslog:function(e,a){var t=this,s=GLOBAL.Util.getPixel();$.ajax({url:l,dataType:"jsonp",data:{qid:t.qid||"null",uid:t.userId||"null",loginid:"null",softtype:"news",softname:"eastday_wapnews",newstype:"ad",from:"null",to:e||"null",os_type:t.osType||"null",browser_type:t.browserType||"null",pixel:s.w+"*"+s.h,ime:"null",refer:GLOBAL.Util.getReferrer()||"null",adv:a||"null"},jsonp:"jsonpcallback",success:function(e){}})},generateChannelTabs:function(e){if(e&&e instanceof Array){for(var a="",t=0;t<e.length;t++)a+=0===t?'<a class="active" data-type="'+e[t].name+'">'+e[t].value+"</a>":'<a data-type="'+e[t].name+'">'+e[t].value+"</a>";y.html(a),"1"==wsCache.get("custom_channels")&&wsCache.set("news_channels",e)}},getMyChannels:function(e,a){if(!e||!a)return[];for(var t=new Array,s=a.length,i=e.length,n=0;s>n;n++)for(var r=0;i>r;r++)a[n].name==e[r].name&&t.push(a[n]);return t},pullDown:function(){var e=this,a=0;w.on("touchstart",function(e){clearTimeout(pullDownLoadDataTimer),startPos=e.touches[0].pageY,g.scrollTop()<=0?isTop=!0:isTop=!1,$pullDownLoading?$pullDownLoading.removeClass("active").css({display:"block",opacity:0,top:a,transform:"translateY(0px)","-webkit-transform":"translateY(0px)"}):(a=$("header").height()-40,$pullDownLoading=$('<svg id="J_svg" class="svg" style="top: '+a+'px"><g id="J_svg_g"><marker id="J_svg_marker" markerWidth="10" markerHeight="10" refX="0" refY="5" orient="auto" markerUnits="userSpaceOnUse"><path d="M0,0 L0,10 L5,5 L0,0" style="fill: #d43d3d;"></path></marker><path stroke-width="3.5" stroke-linecap="round" id="J_svg_path" marker-end="url(#J_svg_marker)" d="M20,9 A11,11 0 1,1 10.5,14.5" style="stroke: #d43d3d; fill: none;"></path><circle id="J_svg_circle" class="path" fill="none" stroke-width="3.5" stroke-linecap="round" cx="25" cy="25" r="11"></circle></g></svg>'))}),w.on("touchend",function(){isSwipeDown&&(touchDistance>=TOUCH_DISTANCE?$pullDownLoading.animate({top:a+TOUCH_DISTANCE/3+"px"},"fast",function(){$pullDownLoading&&$pullDownLoading.addClass("active"),clearTimeout(pullDownLoadDataTimer),pullDownLoadDataTimer=setTimeout(function(){"meinv"==e.newsType?(f.trigger("click"),$pullDownLoading&&$pullDownLoading.remove()):(e.changeRefreshStatus(),e.pullDownLoadData(function(){setTimeout(function(){$pullDownLoading&&$pullDownLoading.fadeOut("fast",function(){$pullDownLoading.remove()})},500)}))},200)}):$pullDownLoading&&$pullDownLoading.animate({opacity:0,top:a},"fast",function(){$pullDownLoading.remove()})),touchDistanceFlag=!0,isSwipeDown=!1}),w.on("touchmove",function(e){var t=e.touches[0].pageY;touchDistance=t-startPos,isTop&&touchDistanceFlag&&touchDistance>0&&(isSwipeDown=!0,touchDistanceFlag=!1),isTop&&isSwipeDown&&(0===g.find(".svg").length&&$pullDownLoading.appendTo("body"),touchDistance>=TOUCH_DISTANCE?($pullDownLoading.find("#J_svg_marker>path").attr("style","fill:#2a90d7"),$pullDownLoading.find("#J_svg_g>path").attr("style","stroke:#2a90d7;fill:none"),touchDistance>=TOUCH_DISTANCE+80&&(touchDistance=TOUCH_DISTANCE+80)):($pullDownLoading.find("#J_svg_marker>path").attr("style","fill:#d43d3d"),$pullDownLoading.find("#J_svg_g>path").attr("style","stroke:#d43d3d;fill:none")),$pullDownLoading.css({opacity:touchDistance/TOUCH_DISTANCE,transform:"rotate("+touchDistance/TOUCH_DISTANCE*720+"deg)","-webkit-transform":"rotate("+touchDistance/TOUCH_DISTANCE*720+"deg)",top:a+touchDistance/3+"px"}),e.preventDefault())})},pullDownLoadData:function(e){var a=this;a.readUrl=a.getReadUrl(),a.pulldown_pgNum=Number(wsCache.get("pulldown_pgnum_"+a.newsType)),wsCache.set("pulldown_pgnum_"+a.newsType,--a.pulldown_pgNum,{exp:86400}),a.pulldown_idx=Number(wsCache.get("pulldown_idx_"+a.newsType)),a.pulldown_idx||(a.pulldown_idx=0),$.ajax({url:s,data:{type:a.newsType,startkey:wsCache.get("startkey_"+a.newsType)?wsCache.get("startkey_"+a.newsType):a.startKey[a.newsType],lastkey:wsCache.get("endkey_"+a.newsType)?wsCache.get("endkey_"+a.newsType):a.endKey[a.newsType],pgnum:a.pulldown_pgNum,idx:a.pulldown_idx,readhistory:a.readUrl,recgid:a.userId,qid:a.qid,os:a.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){},success:function(e){a.generateDomForPulldown(e)},error:function(e){console.error(e)},complete:function(){e&&e()}})},getReadUrl:function(){var e=this,a="";return a="toutiao"==e.newsType||"weikandian"==e.newsType?wsCache.get("read_url_all"):wsCache.get("read_url_"+e.newsType),a?a:null},generateDomForPulldown:function(e){var a=this,t=e&&e.data,s=t.length,i=!1,n=0,r=3,o=s,l=!0;if(a.osType.indexOf("Android")>=0&&Number(a.osType.split(" ")[1])<4.1&&(l=!1),!t||!t.length)return!1;a.pulldown_num++,a.startKey[a.newsType]=e.endkey,wsCache.set("startkey_"+a.newsType,e.endkey,{exp:86400}),a.endKey[a.newsType]=e.newkey,wsCache.set("endkey_"+a.newsType,e.newkey,{exp:86400}),t.reverse(),g.find(".J-read-position").remove(),w.prepend('<a class="J-read-position read-position">上次浏览到这里，点击刷新。</a>'),s>4&&8>s?(n=0,r=3):s>8&&(n=s-8,r=s-5),o=Math.floor((r-n+1)*Math.random()+n);for(var d=0;s>d;d++){var c=t[d],p=c.url,u=c.date,m=c.topic,h=c.isgg,f=c.source,y=c.miniimg,v=c.recommendtype?c.recommendtype:"-1",T=c.hotnews,_=c.ispicnews,L=c.videonews,x=c.videolist,b=c.isadv||"",C=c.adv_id||"",D=c.type,k=c.subtype,U=y.length,A=(c.rowkey,Number(c.hotnews)),j=Number(c.isvideo),O=Number(c.isrecom),S=Number(c.isnxw),I=(c.urlpv,c.picnums,c.praisecnt,c.tramplecnt,""),G="";if("1"==b?(G="&nbsp;",I='class="J-promote-news" data-advid="'+C+'"',a.sendAdShowLog(C,p)):A?(G='<i class="hot">热门</i>',j&&(G+='<i class="video">视频</i>')):O?G='<i class="rec">推荐</i>':j?G='<i class="video">视频</i>':S&&(G='<i class="nuanwen">暖文</i>'),p="1"!=h?"http://toutiao.ynet.com/a/"+p:p,p+="meinv"==a.newsType?"?fr=meinv&#&gid=1&pid=1":"?idx="+(a.pulldown_idx-d-1)+"&recommendtype="+v+"&ishot="+T+"&fr="+a.newsType,i=!0,!i&&d===o){if(GLOBAL.Et.ggTypeArr.contains("gdt")){var B="gdt_"+(+new Date+Math.random().toString(10).substring(2,6));baiduHtmlIframe='<div class="gg-wrap"><iframe id="'+B+'" name="iframe" src="gg/gg_gdt.html?qid='+a.qid+"&uid="+a.userId+"&ggid="+GLOBAL.Et.gg.gdt.li+"&iframeid="+B+'" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" width="100%" height="100%"></iframe></div>'}w.prepend(baiduHtmlIframe),i=!0}if("1"==L){if(l){var N=c.lbimg[0]?c.lbimg[0].src:"",J=$('<section class="news-item news-item-video"><div class="video-wrap"><h3>'+m+'</h3><div class="J-video-box video-box"><video controls="auto" data-type="'+D+'" data-idx="'+(a.idx+d+1)+'" poster="'+N+'" autobuffer="true" preload="none"><source src="'+x[0].src+'" type="video/mp4">您的浏览器不支持该视频播放。</video></div><p class="clearfix"><em class="fl"><i class="video">视频</i></em><em class="fr">'+f+"</em></p></div></section>");w.prepend(J)}}else"2"==L?l&&w.prepend('<section class="news-item news-item-video-link"><a '+I+' data-type="'+D+'" data-subtype="'+k+'" href="'+p+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+m+'</h3> <p><em class="fl"><i class="video">视频</i></em><em class="fr">'+f+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+y[0].src+'"><span class="play-btn"></span></div></div></a></section>'):"1"==_?(y=c.lbimg,w.prepend('<section class="pull-down news-item news-item-s3"><a '+I+' data-type="'+D+'" data-subtype="'+k+'" href="'+p+'"><div class="news-wrap"><h3>'+m+'</h3><div class="img-wrap clearfix"><img class="lazy fl" src="'+y[0].src+'" alt="'+y[0].alt+'"></div><p class="clearfix"><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(u))+'</em><em class="fr">'+f+"</em></p></div></a></section>")):"-1"==_?w.prepend('<section class="news-item news-item-noimg"><a '+I+' data-type="'+D+'" data-subtype="'+k+'" href="'+p+'"><div class="news-wrap"><h3>'+m+'</h3><p class="clearfix"><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(u))+'</em><em class="fr">'+f+"</em></p></div></a></section>"):"0"==_&&(U>=3?w.prepend('<section class="pull-down news-item news-item-s2"><a '+I+' data-type="'+D+'" data-subtype="'+k+'" href="'+p+'"><div class="news-wrap"><h3>'+m+'</h3><div class="img-wrap clearfix"><div class="img fl"><img class="lazy" src="'+y[0].src+'" alt="'+y[0].alt+'"></div><div class="img fl"><img class="lazy" src="'+y[1].src+'" alt="'+y[1].alt+'"></div><div class="img fl"><img class="lazy" src="'+y[2].src+'" alt="'+y[2].alt+'"></div></div><p class="clearfix"><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(u))+'</em><em class="fr">'+f+"</em></p></div></a></section>"):w.prepend('<section class="pull-down news-item news-item-s1"><a '+I+' data-type="'+D+'" data-subtype="'+k+'" href="'+p+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+m+'</h3> <p><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(u))+'</em><em class="fr">'+f+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+y[0].src+'" alt="'+y[0].alt+'"></div></div></a></section>'))}var E=$('<p id="J_recommend_news" class="recommend-news">为您推荐<span>'+s+"</span>条新闻</p>");if(E.appendTo("body"),setTimeout(function(){E.animate({scale:0,opacity:.5},"600",function(){E.remove()})},1200),a.pulldown_num>=20){a.pulldown_num=0;for(var q=w.children(),H=q.length,d=H-1;d>=H-20;d--)q[d].remove()}wsCache.set("pulldown_idx_"+a.newsType,a.pulldown_idx-s,{exp:1200}),setTimeout(function(){w.children().removeClass("pull-down"),wsCache.set("news_"+a.newsType,w.html(),{exp:1200})},400),w.find("video").each(function(e,t){a.setVideoWidthAndHeight($(this)),a.addVideoListener($(this))})},sendAdShowLog:function(e,a){var t=this,s=GLOBAL.Util.getPixel();$.ajax({url:o,dataType:"jsonp",data:{qid:t.qid||"null",uid:t.userId||"null",loginid:"null",softtype:"news",softname:"eastday_wapnews",newstype:"ad",from:"null",advurl:a||"null",os_type:t.osType||"null",browser_type:t.browserType||"null",fr_url:"null",pixel:s.w+"*"+s.h,ime:"null",adv:e||"null"},jsonp:"jsonpcallback",success:function(e){}})},highlightPraiseTrample:function(){var e=this;"meinv"==e.newsType&&(w.find(".J-good").each(function(){var a=$(this);1===e.getPraiseTrampleStatus(a.data("rowkey"))&&a.addClass("active")}),w.find(".J-bad").each(function(){var a=$(this);-1===e.getPraiseTrampleStatus(a.data("rowkey"))&&a.addClass("active")}))},getPraiseTrampleStatus:function(e){var a=wsCache.get("praise_rowkey"),t=wsCache.get("trample_rowkey");return a&&-1!=a.indexOf(e)?1:t&&-1!=t.indexOf(e)?-1:0},cachePraiseTrampleRowkey:function(e,a){var t=wsCache.get("praise_trample_rowkey"),s=wsCache.get("praise_rowkey"),i=wsCache.get("trample_rowkey");t?t+=","+a:t=a,wsCache.set("praise_trample_rowkey",t,{exp:7200}),1===e?(s?s+=","+a:s=a,wsCache.set("praise_rowkey",s,{exp:7200})):(i?i+=","+a:i=a,wsCache.set("trample_rowkey",i,{exp:7200}))},location:function(){var e=this;$.ajax({url:c,dataType:"jsonp",jsonp:"jsonpcallback",success:function(a){try{var t=a.position,s=e.getCityPinyin(t.provname),i=null;s&&(i={prov_id:t.pro_id,prov_py:s,prov_name:t.provname},e.updateDomLocation(i),wsCache.set("location",i,{exp:2592e3}))}catch(n){console.error(n)}},error:function(e,a){console.error(a)}})},updateDomLocation:function(e){y.children("a").eq(1).after('<a data-type="'+e.prov_py+'">'+e.prov_name+"</a>")},getCityPinyin:function(e){switch(e){case"上海":return"shanghai";case"北京":return"beijing";case"河南":return"henan";case"广东":return"guangdong";default:return null}},cacheReadUrl:function(e,a,t){var s=this;if(!s.existReadUrl(e)&&h.contains(a)){var i=wsCache.get("read_url_all");if(i){for(i=i.split(",");i.length>=5;)i.shift();i.push(e),s.readUrl=i.join(",")}else s.readUrl=e;wsCache.set("read_url_all",s.readUrl,{exp:259200});var n=wsCache.get("read_url_"+a);if(n){for(n=n.split(",");n.length>=3;)n.shift();n.push(e),n=n.join(",")}else n=e;if(wsCache.set("read_url_"+a,n,{exp:259200}),t){var r=wsCache.get("read_url_"+t);if(r){for(r=r.split(",");r.length>=3;)r.shift();r.push(e),r=r.join(",")}else r=e;wsCache.set("read_url_"+t,r,{exp:259200})}}},existReadUrl:function(e){var a=wsCache.get("read_url_all");return!(!a||-1===a.indexOf(e))},clearPosition:function(e){wsCache["delete"]("news_pos_"+e)},scrollTo:function(e,a){var t=y.children("a"),s=$(window).width(),i=e[0].offsetLeft,n=e.width();t.removeClass("active"),e.addClass("active"),y.scrollLeft(i+n/2-s/2)},setQid:function(e){e&&Cookies.set("qid",e,{expires:3,path:"/",domain:"eastday.com"})},getQid:function(){var e=Cookies.get("qid");return e?e:""},setUid:function(){var e=this;$.ajax({url:p,dataType:"jsonp",data:{softtype:"news",softname:"eastday_wapnews"},jsonp:"jsonpcallback",success:function(a){try{e.userId=a.uid,Cookies.set("user_id",e.userId,{expires:365,path:"/",domain:"eastday.com"})}catch(t){console.error(t)}},error:function(e){console.error(e)}})},getUid:function(){var e=Cookies.get("user_id");return e?e:""},addLog:function(){var e=GLOBAL.Util.getPixel(),a=this;$.ajax({url:n,data:{qid:a.qid||"null",uid:a.userId||"null",softtype:"news",softname:"eastday_wapnews",newstype:a.newsType||"null",from:wsCache.get("prev_newstype")||"null",to:wsCache.get("current_newstype")||"null",os_type:a.osType||"null",browser_type:a.browserType||"null",pixel:e.w+"*"+e.h,fr_url:GLOBAL.Util.getReferrer()||"null",loginid:"null",ime:"null",idx:"null",ishot:"null",ver:"null",appqid:"null",ttloginid:"null",apptypeid:"null",appver:"null",recommendtype:"null",ispush:"null"},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){console.error(arguments)}})},addOnlineLog:function(){var e=this,a=GLOBAL.Util.getUrlNoParams()+"	"+e.userId+"	"+e.qid+"	null	null	null	"+e.newsType+"	10	null	null	"+e.osType+"	null";$.ajax({url:r,data:{param:encodeURI(a)},dataType:"jsonp",jsonp:"jsonpcallback"})},refreshData:function(e){var a=this,s=wsCache.get("news_"+a.newsType),i=wsCache.get("news_pos_"+a.newsType);s?(w.html(s),i&&g.scrollTop(i),e&&e(),w.find("video").each(function(e,t){a.setVideoWidthAndHeight($(this)),a.addVideoListener($(this))})):(wsCache["delete"]("pulldown_idx_"+a.newsType),wsCache.set("pgnum_"+a.newsType,1,{exp:1200}),a.readUrl=a.getReadUrl(),$.ajax({url:t,data:{type:a.newsType,recgid:a.userId,qid:a.qid,picnewsnum:1,readhistory:a.readUrl,idx:0,pgnum:1,os:a.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){w.html("")},success:function(e){a.generateDom(e),i&&g.scrollTop(i)},complete:function(){e&&e()}}))},pullUpLoadData:function(){var e=this;e.readUrl=e.getReadUrl(),e.pgNum=Number(wsCache.get("pgnum_"+e.newsType)),wsCache.set("pgnum_"+e.newsType,++e.pgNum,{exp:86400}),e.idx=Number(wsCache.get("idx_"+e.newsType)),e.idx||(e.idx=0),$.ajax({url:i,data:{type:e.newsType,startkey:wsCache.get("startkey_"+e.newsType)?wsCache.get("startkey_"+e.newsType):e.startKey[e.newsType],newsnum:"meinv"==e.newsType?10:20,qid:e.qid,readhistory:e.readUrl,idx:e.idx,recgid:e.userId,pgnum:e.pgNum,os:e.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){e.pullUpFlag=!1},success:function(a){e.generateDom(a)},error:function(e,a){console.error(a)},complete:function(){e.pullUpFlag=!0}})},generateDom:function(e){var a=this,t=e&&e.data;if(!t||!t.length)return!1;var s=!0;a.osType.indexOf("Android")>=0&&Number(a.osType.split(" ")[1])<4.1&&(s=!1),a.startKey[a.newsType]=e.endkey,wsCache.set("startkey_"+a.newsType,e.endkey,{exp:86400});for(var i=t.length,n=0;i>n;n++){var r=t[n],o=r.url,l=r.date,d=r.topic,c=r.isgg,p=r.source,u=r.miniimg,g=r.recommendtype?r.recommendtype:"-1",m=r.hotnews,h=r.ispicnews,f=r.videonews,y=r.videolist,v=r.isadv||"",T=r.adv_id||"",_=r.type,L=r.subtype,x=u.length,b=r.rowkey,C=Number(r.hotnews),D=Number(r.isvideo),k=Number(r.isrecom),U=Number(r.isnxw),A=r.urlpv,j=r.picnums,O=r.praisecnt,S=r.tramplecnt,I="",G="";if("1"==v?(G="&nbsp;",I='class="J-promote-news" data-advid="'+T+'"',a.sendAdShowLog(T,o)):C?(G='<i class="hot">热门</i>',D&&(G+='<i class="video">视频</i>')):k?G='<i class="rec">推荐</i>':D?G='<i class="video">视频</i>':U&&(G='<i class="nuanwen">暖文</i>'),o="1"!=c?"http://toutiao.ynet.com/a/"+o:o,o+="meinv"==a.newsType?"?fr=meinv&#&gid=1&pid=1":"?idx="+(a.idx+n+1)+"&recommendtype="+g+"&ishot="+m+"&fr="+a.newsType,"meinv"==a.newsType)w.append('<section class="news-item news-item-s4"><a data-type="'+_+'" data-subtype="'+L+'" href="'+o+'"><div class="news-wrap"><h3>'+d+'</h3><div class="img-wrap clearfix"><img class="lazy fl" src="'+u[0].src+'"></div></div></a><div class="options"><span class="num">'+j+' 图</span><span class="view">'+A+'</span><span class="split">|</span><span class="J-good good" data-rowkey="'+b+'">'+O+'</span><span class="J-bad bad" data-rowkey="'+b+'">'+S+"</span></div></section>");else if("1"==f){if(s){var B=r.lbimg[0].src,N=$('<section class="news-item news-item-video"><div class="video-wrap"><h3>'+d+'</h3><div class="J-video-box video-box"><video controls="auto" data-type="'+_+'" data-idx="'+(a.idx+n+1)+'" poster="'+B+'" autobuffer="true" preload="none"><source src="'+y[0].src+'" type="video/mp4">您的浏览器不支持该视频播放。</video></div><p class="clearfix"><em class="fl"><i class="video">视频</i></em><em class="fr">'+p+"</em></p></div></section>");w.append(N)}}else"2"==f?s&&w.append('<section class="news-item news-item-video-link"><a '+I+' data-type="'+_+'" data-subtype="'+L+'" href="'+o+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+d+'</h3> <p><em class="fl"><i class="video">视频</i></em><em class="fr">'+p+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+u[0].src+'"><span class="play-btn"></span></div></div></a></section>'):"1"==h?(u=r.lbimg,w.append('<section class="news-item news-item-s3"><a '+I+' data-type="'+_+'" data-subtype="'+L+'" href="'+o+'"><div class="news-wrap"><h3>'+d+'</h3><div class="img-wrap clearfix"><img class="lazy fl" src="'+u[0].src+'"></div><p class="clearfix"><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(l))+'</em><em class="fr">'+p+"</em></p></div></a></section>")):"-1"==h?w.append('<section class="news-item news-item-noimg"><a '+I+' data-type="'+_+'" data-subtype="'+L+'" href="'+o+'"><div class="news-wrap"><h3>'+d+'</h3><p class="clearfix"><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(l))+'</em><em class="fr">'+p+"</em></p></div></a></section>"):"0"==h&&(x>=3?w.append('<section class="news-item news-item-s2"><a '+I+' data-type="'+_+'" data-subtype="'+L+'" href="'+o+'"><div class="news-wrap"><h3>'+d+'</h3><div class="img-wrap clearfix"><div class="img fl"><img class="lazy" src="'+u[0].src+'"></div><div class="img fl"><img class="lazy" src="'+u[1].src+'"></div><div class="img fl"><img class="lazy" src="'+u[2].src+'"></div></div><p class="clearfix"><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(l))+'</em><em class="fr">'+p+"</em></p></div></a></section>"):w.append('<section class="news-item news-item-s1"><a '+I+' data-type="'+_+'" data-subtype="'+L+'" href="'+o+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+d+'</h3> <p><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(l))+'</em><em class="fr">'+p+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+u[0].src+'"></div></div></a></section>'))}wsCache.set("idx_"+a.newsType,a.idx+i,{exp:1200}),wsCache.set("news_"+a.newsType,w.html(),{exp:1200}),w.find("video").each(function(e,t){a.setVideoWidthAndHeight($(this)),a.addVideoListener($(this))})},setVideoWidthAndHeight:function(e){setTimeout(function(){e[0].width=e.width(),e[0].height=9*e[0].width/16},100),e.on("loadeddata",function(a){e[0].width=e.width(),e[0].height=9*e.width()/16})},addVideoListener:function(e){var a=this;e.on("playing",function(e){try{var t=$(e.target),s=t[0],i=s.currentSrc,n=Math.floor(1e3*s.duration),r=t.attr("data-idx"),o=t.attr("data-type"),l=t.attr("data-playingTime")?t.attr("data-playingTime"):"null",d=Math.floor(1e3*s.currentTime),c=a.qid+"	"+a.userId+"	news	eastday_wapnews	"+a.newsType+"	"+o+"	"+a.osType+"	"+r+"	"+a.browserType+"	"+i+"	"+n+"	"+l+"	"+d+"	play";t.attr("data-updateTime",+new Date),a.sendVideoLog(c)}catch(p){console.log("Event playing has error!!!",p)}}),e.on("pause",function(e){try{var t=$(e.target),s=t[0],i=s.currentSrc,n=Math.floor(1e3*s.duration),r=t.attr("data-idx"),o=t.attr("data-type"),l=t.attr("data-playingTime")?t.attr("data-playingTime"):"null",d=Math.floor(1e3*s.currentTime),c=a.qid+"	"+a.userId+"	news	eastday_wapnews	"+a.newsType+"	"+o+"	"+a.osType+"	"+r+"	"+a.browserType+"	"+i+"	"+n+"	"+l+"	"+d+"	pause";a.sendVideoLog(c)}catch(p){console.log("Event pause has error!!!",p)}}),e.on("timeupdate",function(e){try{var a=$(e.target),t=parseInt(a.attr("data-updateTime"),10)||+new Date,s=parseInt(a.attr("data-playingTime"),10)||0,i=+new Date;s=s+i-t,a.attr("data-playingTime",s),a.attr("data-updateTime",i)}catch(n){console.log("Event timeupdate has error!!!",n)}})},sendVideoLog:function(e){$.ajax({url:d,data:{param:e},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){}})},setGgId:function(){GLOBAL.Et.gg?GLOBAL.Et.ggTypeArr.contains("baidu")&&GLOBAL.Et.ggTypeArr.contains("sogou")?(baiduHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_baidu.html?ggid='+GLOBAL.Et.gg.baidu.li+'" frameborder="0" scrolling="no" width="100%" height="120"></iframe></div>',sogouHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_sogou.html?ggid='+GLOBAL.Et.gg.sogou.li+'" frameborder="0" scrolling="no" width="100%" height="78"></iframe></div>'):GLOBAL.Et.ggTypeArr.contains("sogou")?sogouHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_sogou.html?ggid='+GLOBAL.Et.gg.sogou.li+'" frameborder="0" scrolling="no" width="100%" height="78"></iframe></div>':GLOBAL.Et.ggTypeArr.contains("baidu")?baiduHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_baidu.html?ggid='+GLOBAL.Et.gg.baidu.li+'" frameborder="0" scrolling="no" width="100%" height="120"></iframe></div>':baiduHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_baidu.html?ggid='+GLOBAL.Et.ggData.root["default"]+'" frameborder="0" scrolling="no" width="100%" height="120"></iframe></div>':baiduHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_baidu.html?ggid='+GLOBAL.Et.ggData.root["default"]+'" frameborder="0" scrolling="no" width="100%" height="120"></iframe></div>'},loadVideoGg:function(e){var a=$('<div class="J-gg-video gg-video"><div class="gg"></div><a class="J-gg-close-video gg-close-video">关闭广告</a></div>'),t=document.createElement("div"),s=document.createElement("script"),i=document.createElement("script"),n="u2643659";t.id="bdUserDefInlay_"+n,s.type="text/javascript",s.innerHTML='var cpro_id = "'+n+'";',i.type="text/javascript",i.src="http://cpro.baidustatic.com/cpro/ui/cm.js",a.find(".gg").append(t).append(s).append(i),a.appendTo(e)},showGg:function(e){e.show(),e.prev().css({width:1,height:1})},hideGg:function(e){e.hide(),e.prev().css({width:"100%",height:"100%"})}},new e});