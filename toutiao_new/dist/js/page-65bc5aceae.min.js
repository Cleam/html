$(function(){function e(){var e=GLOBAL.Util.getQueryString("type"),a=e?e:wsCache.get("current_newstype");this.newsType=a?a:"toutiao",this.readUrl="",this.userId="",this.idx=0,this.pgNum=1,this.pulldown_pgNum=0,this.pulldown_idx=0,this.pulldown_num=0,this.toType=GLOBAL.Util.getQueryString("type"),this.qid=GLOBAL.Et.qid||GLOBAL.Util.getQueryString("qid")||Cookies.get("qid"),this.pullUpFlag=!0,this.startKey={},this.endKey={},this.osType=GLOBAL.Util.getOsType(),this.browserType=GLOBAL.Util.getBrowserType(),this.init()}FastClick.attach(document.body);var a="./data/channels.json",t="http://toutiao.eastday.com/toutiao_h5/RefreshJP",s="http://toutiao.eastday.com/toutiao_h5/pulldown",n="http://toutiao.eastday.com/toutiao_h5/NextJP",i="http://position.dfshurufa.com/position/get",o="http://toutiao.eastday.com/getwapdata/getuid",r="http://toutiao.eastday.com/pjson/zan",l="http://toutiao.eastday.com/getwapdata/data",d="http://ot.dftoutiao.com/online/online",p="http://toutiao.eastday.com/getwapdata/advshow",c="http://toutiao.eastday.com/getwapdata/ad",u="http://toutiao.eastday.com/getwapdata/videoact",w=$("body"),h=[],m=[],g=$("#J_news_list"),f=$("#J_refresh"),y=$("#J_top_menu"),v=$("#J_gg_baidu_id"),T=$("#J_gg_sogou_id");praiseTrampleFlag=!0,startPos=0,touchDistance=0,touchDistanceFlag=!0,isSwipeDown=!1,isTop=!1,$pullDownLoading=null,TOUCH_DISTANCE=150,pullDownLoadDataTimer=null,wsCache=new WebStorageCache,baiduHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_baidu.html" frameborder="0" scrolling="no" width="100%" height="62"></iframe></div>',sogouHtmlIframe='<div class="gg-wrap"><iframe src="gg/gg_sogou.html" frameborder="0" scrolling="no" width="100%" height="78"></iframe></div>',e.prototype={init:function(){function e(e,t,s){var n=e.data("rowkey"),i=a.getPraiseTrampleStatus(n);return 1===i?void alert("您已经赞过了！"):-1===i?void alert("您已经踩过了！"):void(praiseTrampleFlag&&(praiseTrampleFlag=!1,e.addClass("active").text(Number(e.text())+1),$.ajax({url:r,dataType:"jsonp",data:{colname:t,rowkey:n,praisecnt:1},jsonp:"jsonpcallback",success:function(e){a.cachePraiseTrampleRowkey(s,n),praiseTrampleFlag=!0},error:function(e){console.error(e)}})))}var a=this;a.setGgId(),a.qid?a.setQid(a.qid):Cookies.remove("qid",{path:"/",domain:"eastday.com"}),a.userId=a.getUid(),a.userId||a.setUid(),a.readUrl=wsCache.get("read_url_all"),a.readUrl||(a.readUrl=""),a.initChannels(function(){var e=y.children("a");e.each(function(){var e=$(this),a=e.data("type");h.push(a),"meinv"!==a&&"nuanwen"!==a&&m.push(a)}),e.each(function(){var e=$(this);return e.data("type")==a.newsType?(setTimeout(function(){a.scrollTo(e,!1)},50),!1):void 0}),wsCache.get("location")?a.updateDomLocation(wsCache.get("location")):a.location()}),a.refreshData(function(){a.highlightPraiseTrample()}),a.addLog(),a.pullDown(),y.on("tap","a",function(){var e=$(this),t=e.data("type");a.newsType=t,e.hasClass("active")||(a.scrollTo(e,!1),wsCache.set("prev_newstype",a.newsType,{exp:1200}),wsCache.set("current_newstype",t,{exp:1200}),a.refreshData(function(){a.highlightPraiseTrample()}),a.addLog())}),$(window).on("scroll",function(){var e=GLOBAL.Util.getScrollTop(),t=$("#J_loading").offset().top,s=GLOBAL.Util.getClientHeight(),n=null;n&&clearTimeout(n),n=setTimeout(function(){wsCache.set("news_pos_"+a.newsType,e,{exp:1200})},200),t>=s&&e+s>=t&&a.pullUpFlag&&a.pullUpLoadData(),g.find("video").each(function(){var e=$(this),a=e.offset().top,t=w.scrollTop();(t>=a||a-t>=$(window).height()-e.height())&&(this.paused||this.pause())})}),f.on("tap",function(){f.hasClass("active")||(a.changeRefreshStatus(),wsCache["delete"]("news_pos_"+a.newsType),wsCache["delete"]("news_"+a.newsType),wsCache.set("pulldown_pgnum_"+a.newsType,0,{exp:86400}),a.refreshData(function(){a.highlightPraiseTrample()}))}),g.on("click","a",function(e){var t=$(this),s=t.attr("href");s=s.substring(s.indexOf("/mobile/")+8,s.indexOf(".html")),a.cacheReadUrl(s,t.data("type"),t.data("subtype")),g.find("video").each(function(){this.paused||this.pause()})}),w.on("click",".J-read-position",function(){w.scrollTop(0),a.changeRefreshStatus(),a.pullDownLoadData()}),w.on("click",".J-promote-news",function(){var e=$(this),t=e.attr("href"),s=e.data("advid");a.sendPromoteNewslog(t,s)}),g.on("click",".J-good",function(){e($(this),"z0000",1)}),g.on("click",".J-bad",function(){e($(this),"zd0000",-1)}),a.addOnlineLog(),setInterval(function(){a.addOnlineLog()},1e4)},changeRefreshStatus:function(){f.addClass("active"),setTimeout(function(){f.removeClass("active")},700)},initChannels:function(e){var t=this,s=wsCache.get("news_channels");s?(t.generateChannelTabs(s),e&&e()):$.ajax({url:a,dataType:"json",success:function(a){t.generateChannelTabs(a.channels.up),e&&e()},error:function(){console.error(arguments)}})},sendPromoteNewslog:function(e,a){var t=this,s=GLOBAL.Util.getPixel();$.ajax({url:c,dataType:"jsonp",data:{qid:t.qid||"null",uid:t.userId||"null",loginid:"null",softtype:"news",softname:"eastday_wapnews",newstype:"ad",from:"null",to:e||"null",os_type:t.osType||"null",browser_type:t.browserType||"null",pixel:s.w+"*"+s.h,ime:"null",refer:GLOBAL.Util.getReferrer()||"null",adv:a||"null"},jsonp:"jsonpcallback",success:function(e){}})},generateChannelTabs:function(e){if(e&&e instanceof Array){for(var a="",t=0;t<e.length;t++)a+=0===t?'<a class="active" data-type="'+e[t].name+'">'+e[t].value+"</a>":'<a data-type="'+e[t].name+'">'+e[t].value+"</a>";y.html(a),"1"==wsCache.get("custom_channels")&&wsCache.set("news_channels",e)}},getMyChannels:function(e,a){if(!e||!a)return[];for(var t=new Array,s=a.length,n=e.length,i=0;s>i;i++)for(var o=0;n>o;o++)a[i].name==e[o].name&&t.push(a[i]);return t},pullDown:function(){var e=this,a=0;g.on("touchstart",function(e){clearTimeout(pullDownLoadDataTimer),startPos=e.touches[0].pageY,w.scrollTop()<=0?isTop=!0:isTop=!1,$pullDownLoading?$pullDownLoading.removeClass("active").css({display:"block",opacity:0,top:a,transform:"translateY(0px)","-webkit-transform":"translateY(0px)"}):(a=$("header").height()-40,$pullDownLoading=$('<svg id="J_svg" class="svg" style="top: '+a+'px"><g id="J_svg_g"><marker id="J_svg_marker" markerWidth="10" markerHeight="10" refX="0" refY="5" orient="auto" markerUnits="userSpaceOnUse"><path d="M0,0 L0,10 L5,5 L0,0" style="fill: #d43d3d;"></path></marker><path stroke-width="3.5" stroke-linecap="round" id="J_svg_path" marker-end="url(#J_svg_marker)" d="M20,9 A11,11 0 1,1 10.5,14.5" style="stroke: #d43d3d; fill: none;"></path><circle id="J_svg_circle" class="path" fill="none" stroke-width="3.5" stroke-linecap="round" cx="25" cy="25" r="11"></circle></g></svg>'))}),g.on("touchend",function(){isSwipeDown&&(touchDistance>=TOUCH_DISTANCE?$pullDownLoading.animate({top:a+TOUCH_DISTANCE/3+"px"},"fast",function(){$pullDownLoading&&$pullDownLoading.addClass("active"),clearTimeout(pullDownLoadDataTimer),pullDownLoadDataTimer=setTimeout(function(){"meinv"==e.newsType?(f.trigger("click"),$pullDownLoading&&$pullDownLoading.remove()):(e.changeRefreshStatus(),e.pullDownLoadData(function(){setTimeout(function(){$pullDownLoading&&$pullDownLoading.fadeOut("fast",function(){$pullDownLoading.remove()})},500)}))},200)}):$pullDownLoading&&$pullDownLoading.animate({opacity:0,top:a},"fast",function(){$pullDownLoading.remove()})),touchDistanceFlag=!0,isSwipeDown=!1}),g.on("touchmove",function(e){var t=e.touches[0].pageY;touchDistance=t-startPos,isTop&&touchDistanceFlag&&touchDistance>0&&(isSwipeDown=!0,touchDistanceFlag=!1),isTop&&isSwipeDown&&(0===w.find(".svg").length&&$pullDownLoading.appendTo("body"),touchDistance>=TOUCH_DISTANCE?($pullDownLoading.find("#J_svg_marker>path").attr("style","fill:#2a90d7"),$pullDownLoading.find("#J_svg_g>path").attr("style","stroke:#2a90d7;fill:none"),touchDistance>=TOUCH_DISTANCE+80&&(touchDistance=TOUCH_DISTANCE+80)):($pullDownLoading.find("#J_svg_marker>path").attr("style","fill:#d43d3d"),$pullDownLoading.find("#J_svg_g>path").attr("style","stroke:#d43d3d;fill:none")),$pullDownLoading.css({opacity:touchDistance/TOUCH_DISTANCE,transform:"rotate("+touchDistance/TOUCH_DISTANCE*720+"deg)","-webkit-transform":"rotate("+touchDistance/TOUCH_DISTANCE*720+"deg)",top:a+touchDistance/3+"px"}),e.preventDefault())})},pullDownLoadData:function(e){var a=this;a.readUrl=a.getReadUrl(),a.pulldown_pgNum=Number(wsCache.get("pulldown_pgnum_"+a.newsType)),wsCache.set("pulldown_pgnum_"+a.newsType,--a.pulldown_pgNum,{exp:86400}),a.pulldown_idx=Number(wsCache.get("pulldown_idx_"+a.newsType)),a.pulldown_idx||(a.pulldown_idx=0),$.ajax({url:s,data:{type:a.newsType,startkey:wsCache.get("startkey_"+a.newsType)?wsCache.get("startkey_"+a.newsType):a.startKey[a.newsType],lastkey:wsCache.get("endkey_"+a.newsType)?wsCache.get("endkey_"+a.newsType):a.endKey[a.newsType],pgnum:a.pulldown_pgNum,idx:a.pulldown_idx,readhistory:a.readUrl,recgid:a.userId,qid:a.qid,os:a.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){},success:function(e){a.generateDomForPulldown(e)},error:function(e){console.error(e)},complete:function(){e&&e()}})},getReadUrl:function(){var e=this,a="";return a="toutiao"==e.newsType||"weikandian"==e.newsType?wsCache.get("read_url_all"):wsCache.get("read_url_"+e.newsType),a?a:null},generateDomForPulldown:function(e){var a=this,t=e&&e.data,s=t.length,n=!1,i=0,o=3,r=s;if(!t||!t.length)return!1;a.pulldown_num++,a.startKey[a.newsType]=e.endkey,wsCache.set("startkey_"+a.newsType,e.endkey,{exp:86400}),a.endKey[a.newsType]=e.newkey,wsCache.set("endkey_"+a.newsType,e.newkey,{exp:86400}),t.reverse(),w.find(".J-read-position").remove(),g.prepend('<a class="J-read-position read-position">上次浏览到这里，点击刷新。</a>'),s>4&&8>s?(i=0,o=3):s>8&&(i=s-8,o=s-5),r=Math.floor((o-i+1)*Math.random()+i);for(var l=0;s>l;l++){var d=t[l],p=d.url,c=d.date,u=d.topic,h=d.source,m=d.miniimg,f=d.recommendtype?d.recommendtype:"-1",y=d.hotnews,T=d.ispicnews,_=d.videonews,L=d.videolist,x=d.isadv||"",C=d.adv_id||"",b=d.type,D=d.subtype,k=m.length,A=(d.rowkey,Number(d.hotnews)),U=Number(d.isvideo),O=Number(d.isrecom),j=Number(d.isnxw),S=(d.urlpv,d.picnums,d.praisecnt,d.tramplecnt,""),G="";"1"==x?(G="&nbsp;",S='class="J-promote-news" data-advid="'+C+'"',a.sendAdShowLog(C,p)):A?(G='<i class="hot">热门</i>',U&&(G+='<i class="video">视频</i>')):O?G='<i class="rec">推荐</i>':U?G='<i class="video">视频</i>':j&&(G='<i class="nuanwen">暖文</i>'),p+="meinv"==a.newsType?"?fr=meinv&#&gid=1&pid=1":"?idx="+(a.pulldown_idx-l-1)+"&recommendtype="+f+"&ishot="+y+"&fr="+a.newsType,n||l!==r||(v.val()?g.prepend(baiduHtmlIframe):g.prepend(sogouHtmlIframe),n=!0);var B=!0;if(a.osType.indexOf("Android")>=0&&Number(a.osType.split(" ")[1])<4&&(B=!1),"1"==_){if(B){var I=d.lbimg[0].src;g.prepend('<section class="news-item news-item-video"><div class="video-wrap"><h3>'+u+'</h3><video controls="auto" data-type="'+b+'" data-idx="'+(a.idx+l+1)+'" poster="'+I+'" autobuffer="true" preload="none"><source src="'+L[0].src+'" type="video/mp4">您的浏览器不支持该视频播放。</video><p class="clearfix"><em class="fl"><i class="video">视频</i></em><em class="fr">'+h+"</em></p></div></section>")}}else"1"==T?(m=d.lbimg,g.prepend('<section class="pull-down news-item news-item-s3"><a '+S+' data-type="'+b+'" data-subtype="'+D+'" href="'+p+'"><div class="news-wrap"><h3>'+u+'</h3><div class="img-wrap clearfix"><img class="lazy fl" src="'+m[0].src+'" alt="'+m[0].alt+'"></div><p class="clearfix"><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(c))+'</em><em class="fr">'+h+"</em></p></div></a></section>")):"-1"==T?g.prepend('<section class="news-item news-item-noimg"><a '+S+' data-type="'+b+'" data-subtype="'+D+'" href="'+p+'"><div class="news-wrap"><h3>'+u+'</h3><p class="clearfix"><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(c))+'</em><em class="fr">'+h+"</em></p></div></a></section>"):k>=3?g.prepend('<section class="pull-down news-item news-item-s2"><a '+S+' data-type="'+b+'" data-subtype="'+D+'" href="'+p+'"><div class="news-wrap"><h3>'+u+'</h3><div class="img-wrap clearfix"><div class="img fl"><img class="lazy" src="'+m[0].src+'" alt="'+m[0].alt+'"></div><div class="img fl"><img class="lazy" src="'+m[1].src+'" alt="'+m[1].alt+'"></div><div class="img fl"><img class="lazy" src="'+m[2].src+'" alt="'+m[2].alt+'"></div></div><p class="clearfix"><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(c))+'</em><em class="fr">'+h+"</em></p></div></a></section>"):g.prepend('<section class="pull-down news-item news-item-s1"><a '+S+' data-type="'+b+'" data-subtype="'+D+'" href="'+p+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+u+'</h3> <p><em class="fl">'+(G?G:GLOBAL.Util.getSpecialTimeStr(c))+'</em><em class="fr">'+h+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+m[0].src+'" alt="'+m[0].alt+'"></div></div></a></section>')}var N=$('<p id="J_recommend_news" class="recommend-news">为您推荐<span>'+s+"</span>条新闻</p>");if(N.appendTo("body"),setTimeout(function(){N.animate({scale:0,opacity:.5},"600",function(){N.remove()})},1200),a.pulldown_num>=20){a.pulldown_num=0;for(var J=g.children(),E=J.length,l=E-1;l>=E-20;l--)J[l].remove()}wsCache.set("pulldown_idx_"+a.newsType,a.pulldown_idx-s,{exp:1200}),setTimeout(function(){g.children().removeClass("pull-down"),wsCache.set("news_"+a.newsType,g.html(),{exp:1200})},400),g.find("video").each(function(e,t){a.setVideoWidthAndHeight($(this)),a.addVideoListener($(this))})},sendAdShowLog:function(e,a){var t=this,s=GLOBAL.Util.getPixel();$.ajax({url:p,dataType:"jsonp",data:{qid:t.qid||"null",uid:t.userId||"null",loginid:"null",softtype:"news",softname:"eastday_wapnews",newstype:"ad",from:"null",advurl:a||"null",os_type:t.osType||"null",browser_type:t.browserType||"null",fr_url:"null",pixel:s.w+"*"+s.h,ime:"null",adv:e||"null"},jsonp:"jsonpcallback",success:function(e){}})},highlightPraiseTrample:function(){var e=this;"meinv"==e.newsType&&(g.find(".J-good").each(function(){var a=$(this);1===e.getPraiseTrampleStatus(a.data("rowkey"))&&a.addClass("active")}),g.find(".J-bad").each(function(){var a=$(this);-1===e.getPraiseTrampleStatus(a.data("rowkey"))&&a.addClass("active")}))},getPraiseTrampleStatus:function(e){var a=wsCache.get("praise_rowkey"),t=wsCache.get("trample_rowkey");return a&&-1!=a.indexOf(e)?1:t&&-1!=t.indexOf(e)?-1:0},cachePraiseTrampleRowkey:function(e,a){var t=wsCache.get("praise_trample_rowkey"),s=wsCache.get("praise_rowkey"),n=wsCache.get("trample_rowkey");t?t+=","+a:t=a,wsCache.set("praise_trample_rowkey",t,{exp:31536e3}),1===e?(s?s+=","+a:s=a,wsCache.set("praise_rowkey",s,{exp:31536e3})):(n?n+=","+a:n=a,wsCache.set("trample_rowkey",n,{exp:31536e3}))},location:function(){var e=this;$.ajax({url:i,dataType:"jsonp",jsonp:"jsonpcallback",success:function(a){try{var t=a.position,s=e.getCityPinyin(t.provname),n=null;s&&(n={prov_id:t.pro_id,prov_py:s,prov_name:t.provname},e.updateDomLocation(n),wsCache.set("location",n,{exp:2592e3}))}catch(i){console.error(i)}},error:function(e,a){console.error(a)}})},updateDomLocation:function(e){y.children("a").eq(1).after('<a data-type="'+e.prov_py+'">'+e.prov_name+"</a>")},getCityPinyin:function(e){switch(e){case"上海":return"shanghai";case"北京":return"beijing";case"河南":return"henan";case"广东":return"guangdong";default:return null}},cacheReadUrl:function(e,a,t){var s=this;if(!s.existReadUrl(e)&&m.contains(a)){var n=wsCache.get("read_url_all");if(n){for(n=n.split(",");n.length>=5;)n.shift();n.push(e),s.readUrl=n.join(",")}else s.readUrl=e;wsCache.set("read_url_all",s.readUrl,{exp:259200});var i=wsCache.get("read_url_"+a);if(i){for(i=i.split(",");i.length>=3;)i.shift();i.push(e),i=i.join(",")}else i=e;if(wsCache.set("read_url_"+a,i,{exp:259200}),t){var o=wsCache.get("read_url_"+t);if(o){for(o=o.split(",");o.length>=3;)o.shift();o.push(e),o=o.join(",")}else o=e;wsCache.set("read_url_"+t,o,{exp:259200})}}},existReadUrl:function(e){var a=wsCache.get("read_url_all");return!(!a||-1===a.indexOf(e))},clearPosition:function(e){wsCache["delete"]("news_pos_"+e)},scrollTo:function(e,a){var t=y.children("a"),s=$(window).width(),n=e[0].offsetLeft,i=e.width();t.removeClass("active"),e.addClass("active"),y.scrollLeft(n+i/2-s/2)},setQid:function(e){e&&Cookies.set("qid",e,{expires:3,path:"/",domain:"eastday.com"})},getQid:function(){var e=Cookies.get("qid");return e?e:""},setUid:function(){var e=this;$.ajax({url:o,dataType:"jsonp",data:{softtype:"news",softname:"eastday_wapnews"},jsonp:"jsonpcallback",success:function(a){try{e.userId=a.uid,Cookies.set("user_id",e.userId,{expires:365,path:"/",domain:"eastday.com"})}catch(t){console.error(t)}},error:function(e){console.error(e)}})},getUid:function(){var e=Cookies.get("user_id");return e?e:""},addLog:function(){var e=GLOBAL.Util.getPixel(),a=this;$.ajax({url:l,data:{qid:a.qid||"null",uid:a.userId||"null",softtype:"news",softname:"eastday_wapnews",newstype:a.newsType||"null",from:wsCache.get("prev_newstype")||"null",to:wsCache.get("current_newstype")||"null",os_type:a.osType||"null",browser_type:a.browserType||"null",pixel:e.w+"*"+e.h,fr_url:GLOBAL.Util.getReferrer()||"null",loginid:"null",ime:"null",idx:"null",ishot:"null",ver:"null",appqid:"null",ttloginid:"null",apptypeid:"null",appver:"null",recommendtype:"null",ispush:"null"},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){console.error(arguments)}})},addOnlineLog:function(){var e=this,a=GLOBAL.Util.getUrlNoParams()+"	"+e.userId+"	"+e.qid+"	null	null	null	"+e.newsType+"	10	null	null	"+e.osType+"	null";$.ajax({url:d,data:{param:encodeURI(a)},dataType:"jsonp",jsonp:"jsonpcallback"})},refreshData:function(e){var a=this,s=wsCache.get("news_"+a.newsType),n=wsCache.get("news_pos_"+a.newsType);s?(g.html(s),n&&w.scrollTop(n),e&&e(),g.find("video").each(function(e,t){a.setVideoWidthAndHeight($(this)),a.addVideoListener($(this))})):(wsCache["delete"]("pulldown_idx_"+a.newsType),wsCache.set("pgnum_"+a.newsType,1,{exp:1200}),a.readUrl=a.getReadUrl(),$.ajax({url:t,data:{type:a.newsType,recgid:a.userId,qid:a.qid,picnewsnum:1,readhistory:a.readUrl,idx:0,pgnum:1,os:a.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){g.html("")},success:function(e){a.generateDom(e),n&&w.scrollTop(n)},complete:function(){e&&e()}}))},pullUpLoadData:function(){var e=this;e.readUrl=e.getReadUrl(),e.pgNum=Number(wsCache.get("pgnum_"+e.newsType)),wsCache.set("pgnum_"+e.newsType,++e.pgNum,{exp:86400}),e.idx=Number(wsCache.get("idx_"+e.newsType)),e.idx||(e.idx=0),$.ajax({url:n,data:{type:e.newsType,startkey:wsCache.get("startkey_"+e.newsType)?wsCache.get("startkey_"+e.newsType):e.startKey[e.newsType],newsnum:"meinv"==e.newsType?10:20,qid:e.qid,readhistory:e.readUrl,idx:e.idx,recgid:e.userId,pgnum:e.pgNum,os:e.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){e.pullUpFlag=!1},success:function(a){e.generateDom(a)},error:function(e,a){console.error(a)},complete:function(){e.pullUpFlag=!0}})},generateDom:function(e){var a=this,t=e&&e.data;if(!t||!t.length)return!1;a.startKey[a.newsType]=e.endkey,wsCache.set("startkey_"+a.newsType,e.endkey,{exp:86400});for(var s=t.length,n=0;s>n;n++){var i=t[n],o=i.url,r=i.date,l=i.topic,d=i.source,p=i.miniimg,c=i.recommendtype?i.recommendtype:"-1",u=i.hotnews,w=i.ispicnews,h=i.videonews,m=i.videolist,f=i.isadv||"",y=i.adv_id||"",v=i.type,T=i.subtype,_=p.length,L=i.rowkey,x=Number(i.hotnews),C=Number(i.isvideo),b=Number(i.isrecom),D=Number(i.isnxw),k=i.urlpv,A=i.picnums,U=i.praisecnt,O=i.tramplecnt,j="",S="";if("1"==f?(S="&nbsp;",j='class="J-promote-news" data-advid="'+y+'"',a.sendAdShowLog(y,o)):x?(S='<i class="hot">热门</i>',C&&(S+='<i class="video">视频</i>')):b?S='<i class="rec">推荐</i>':C?S='<i class="video">视频</i>':D&&(S='<i class="nuanwen">暖文</i>'),o+="meinv"==a.newsType?"?fr=meinv&#&gid=1&pid=1":"?idx="+(a.idx+n+1)+"&recommendtype="+c+"&ishot="+u+"&fr="+a.newsType,"meinv"==a.newsType)g.append('<section class="news-item news-item-s4"><a data-type="'+v+'" data-subtype="'+T+'" href="'+o+'"><div class="news-wrap"><h3>'+l+'</h3><div class="img-wrap clearfix"><img class="lazy fl" src="'+p[0].src+'"></div></div></a><div class="options"><span class="num">'+A+' 图</span><span class="view">'+k+'</span><span class="split">|</span><span class="J-good good" data-rowkey="'+L+'">'+U+'</span><span class="J-bad bad" data-rowkey="'+L+'">'+O+"</span></div></section>");else{GLOBAL.Et.gg?GLOBAL.Et.ggTypeArr.contains("baidu")&&GLOBAL.Et.ggTypeArr.contains("sogou")?7===n||15===n?g.append(baiduHtmlIframe):11!==n&&19!==n||g.append(sogouHtmlIframe):GLOBAL.Et.ggTypeArr.contains("sogou")?7!==n&&11!==n&&15!==n&&19!==n||g.append(sogouHtmlIframe):GLOBAL.Et.ggTypeArr.contains("baidu")?7!==n&&15!==n||g.append(baiduHtmlIframe):7!==n&&15!==n||g.append(baiduHtmlIframe):7!==n&&15!==n||g.append(baiduHtmlIframe);var G=!0;if(a.osType.indexOf("Android")>=0&&Number(a.osType.split(" ")[1])<4&&(G=!1),"1"==h){if(G){var B=i.lbimg[0].src;g.append('<section class="news-item news-item-video"><div class="video-wrap"><h3>'+l+'</h3><video controls="auto" data-type="'+v+'" data-idx="'+(a.idx+n+1)+'" poster="'+B+'" autobuffer="true" preload="none"><source src="'+m[0].src+'" type="video/mp4">您的浏览器不支持该视频播放。</video><p class="clearfix"><em class="fl"><i class="video">视频</i></em><em class="fr">'+d+"</em></p></div></section>")}}else"1"==w?(p=i.lbimg,g.append('<section class="news-item news-item-s3"><a '+j+' data-type="'+v+'" data-subtype="'+T+'" href="'+o+'"><div class="news-wrap"><h3>'+l+'</h3><div class="img-wrap clearfix"><img class="lazy fl" src="'+p[0].src+'"></div><p class="clearfix"><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(r))+'</em><em class="fr">'+d+"</em></p></div></a></section>")):"-1"==w?g.append('<section class="news-item news-item-noimg"><a '+j+' data-type="'+v+'" data-subtype="'+T+'" href="'+o+'"><div class="news-wrap"><h3>'+l+'</h3><p class="clearfix"><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(r))+'</em><em class="fr">'+d+"</em></p></div></a></section>"):_>=3?g.append('<section class="news-item news-item-s2"><a '+j+' data-type="'+v+'" data-subtype="'+T+'" href="'+o+'"><div class="news-wrap"><h3>'+l+'</h3><div class="img-wrap clearfix"><div class="img fl"><img class="lazy" src="'+p[0].src+'"></div><div class="img fl"><img class="lazy" src="'+p[1].src+'"></div><div class="img fl"><img class="lazy" src="'+p[2].src+'"></div></div><p class="clearfix"><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(r))+'</em><em class="fr">'+d+"</em></p></div></a></section>"):g.append('<section class="news-item news-item-s1"><a '+j+' data-type="'+v+'" data-subtype="'+T+'" href="'+o+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+l+'</h3> <p><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(r))+'</em><em class="fr">'+d+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+p[0].src+'"></div></div></a></section>')}}wsCache.set("idx_"+a.newsType,a.idx+s,{exp:1200}),wsCache.set("news_"+a.newsType,g.html(),{exp:1200}),g.find("video").each(function(e,t){a.setVideoWidthAndHeight($(this)),a.addVideoListener($(this))})},setVideoWidthAndHeight:function(e){setTimeout(function(){e[0].width=e.width(),e[0].height=9*e[0].width/16},100),e.on("loadeddata",function(a){e[0].width=e.width(),e[0].height=9*e.width()/16})},addVideoListener:function(e){var a=this;e.on("playing",function(e){try{var t=$(e.target),s=t[0],n=s.currentSrc,i=Math.floor(1e3*s.duration),o=t.attr("data-idx"),r=t.attr("data-type"),l=t.attr("data-playingTime")?t.attr("data-playingTime"):"null",d=Math.floor(1e3*s.currentTime),p=a.qid+"	"+a.userId+"	news	eastday_wapnews	"+a.newsType+"	"+r+"	"+a.osType+"	"+o+"	"+a.browserType+"	"+n+"	"+i+"	"+l+"	"+d+"	play";t.attr("data-updateTime",+new Date),a.sendVideoLog(p)}catch(c){console.log("Event playing has error!!!",c)}}),e.on("pause",function(e){try{var t=$(e.target),s=t[0],n=s.currentSrc,i=Math.floor(1e3*s.duration),o=t.attr("data-idx"),r=t.attr("data-type"),l=t.attr("data-playingTime")?t.attr("data-playingTime"):"null",d=Math.floor(1e3*s.currentTime),p=a.qid+"	"+a.userId+"	news	eastday_wapnews	"+a.newsType+"	"+r+"	"+a.osType+"	"+o+"	"+a.browserType+"	"+n+"	"+i+"	"+l+"	"+d+"	pause";a.sendVideoLog(p)}catch(c){console.log("Event pause has error!!!",c)}}),e.on("timeupdate",function(e){try{var a=$(e.target),t=parseInt(a.attr("data-updateTime"),10)||+new Date,s=parseInt(a.attr("data-playingTime"),10)||0,n=+new Date;s=s+n-t,a.attr("data-playingTime",s),a.attr("data-updateTime",n)}catch(i){console.log("Event timeupdate has error!!!",i)}})},sendVideoLog:function(e){$.ajax({url:u,data:{param:e},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){}})},setGgId:function(){GLOBAL.Et.gg?GLOBAL.Et.ggTypeArr.contains("baidu")&&GLOBAL.Et.ggTypeArr.contains("sogou")?(v.val(GLOBAL.Et.gg.baidu.li),T.val(GLOBAL.Et.gg.sogou.li)):GLOBAL.Et.ggTypeArr.contains("sogou")?T.val(GLOBAL.Et.gg.sogou.li):GLOBAL.Et.ggTypeArr.contains("baidu")?v.val(GLOBAL.Et.gg.baidu.li):v.val(GLOBAL.Et.ggData.root["default"]):v.val(GLOBAL.Et.ggData.root["default"])}},new e});