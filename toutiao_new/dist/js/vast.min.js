$(function(){function t(){this.URL="http://delivery.maihehd.com/d/vast/3.0?pos=100",this.LOG_URL="http://vastlog.dfshurufa.com/vast/brush",this.PROBABILITY=.01,this.TOTAL=100,this.randomArr=[],this.random=Math.floor(this.TOTAL*Math.random()),this.init()}t.prototype={init:function(){var t=this,e=0,r=0;for(e=0;e<t.TOTAL;e++)t.randomArr[e]=!1;for(e=0;e<t.PROBABILITY*t.TOTAL;e++)r=Math.floor(t.TOTAL*Math.random()),t.randomArr[r]=!0;t.getXml()},getXml:function(){var t=this;$.ajax({url:t.URL,type:"GET",dataType:"xml",success:function(e,r,n){if("success"===r){var a=t.getXmlInfo(t.resolveXml(n.responseText));t.resolveData(a,0)}}})},resolveXml:function(t){var e=null;if(!window.DOMParser&&window.ActiveXObject)for(var r=["MSXML.2.DOMDocument.6.0","MSXML.2.DOMDocument.3.0","Microsoft.XMLDOM"],n=0;n<r.length;n++)try{e=new ActiveXObject(r[n]),e.async=!1,e.loadXML(t);break}catch(a){}else{if(!(window.DOMParser&&document.implementation&&document.implementation.createDocument))return null;try{domParser=new DOMParser,e=domParser.parseFromString(t,"text/xml")}catch(a){}}return e},getXmlInfo:function(t){var e=this,r=[];if(t){var n=t.getElementsByTagName("Ad"),a=n.length,i=0;if(n&&0!==a){for(i=0;a>i;i++){var o=n[i],s=o.getAttribute("id"),c=o.getElementsByTagName("Duration")[0].innerHTML,l=o.getElementsByTagName("TrackingEvents")[0],u=l.getElementsByTagName("Tracking"),d=u.length,m=[],T=[],f=0,g=o.getElementsByTagName("VideoClicks")[0],p=g.getElementsByTagName("ClickTracking")[0];for(c=e.strToTime(c),f=Math.floor((c-1)*Math.random()+1),i=0;d>i;i++){var h=u[i];"start"===h.getAttribute("event")?m.push(h):"complete"===h.getAttribute("event")&&T.push(h)}r.push({adId:s,duration:c,clkTime:f,startTracking:m,completeTracking:T,clickTracking:p})}return r}}},resolveData:function(t,e){if(t&&t instanceof Array&&!(e>=t.length)){var r=this,n=t[e],a=n.adId,i=n.duration,o=n.clkTime,s=n.startTracking,c=n.completeTracking,l=n.clickTracking,u=0;for(u=0;u<s.length;u++){var d=s[u].innerHTML.replace(/<\!\[CDATA\[/,"").replace(/]]>/,"");r.sendAjax({vastUrl:r.URL,url:d,adId:a,type:"start",duration:i})}r.randomArr[r.random]&&setTimeout(function(){var t=l.innerHTML.replace(/<\!\[CDATA\[/,"").replace(/]]>/,"");r.sendAjax({vastUrl:r.URL,url:t,adId:a,type:"click",duration:i})},1e3*o),setTimeout(function(){for(u=0;u<c.length;u++){var t=c[u].innerHTML.replace(/<\!\[CDATA\[/,"").replace(/]]>/,"");r.sendAjax({vastUrl:r.URL,url:t,adId:a,type:"complete",duration:i})}},1e3*i),function(t,e,n){setTimeout(function(){e+=1,r.resolveData(t,e)},1e3*n)}(t,e,i)}},sendAjax:function(t){var e=this;t&&$.ajax({url:t.url,type:"GET",error:function(){t.status="fail",e.sendLog(t)},success:function(){t.status="success",e.sendLog(t)}})},strToTime:function(t){var e=t.split(":"),r=parseInt(e[0],10),n=parseInt(e[1],10),a=parseInt(e[2],10);return 3600*r+60*n+a},sendLog:function(t){var e=this,r=GLOBAL.Et.qid||Cookies.get("qid")||"null",n=GLOBAL.Et.uid||Cookies.get("user_id")||"null",a=GLOBAL.Util.getOsType(),i=GLOBAL.Util.getBrowserType(),o=window.location.href.split("?")[0],s="",c=navigator.userAgent,l="";c.indexOf("iPad")>-1?s="iPad":c.indexOf("Android")>-1||c.indexOf("Linux")>-1?s="Android":GLOBAL.Os.ios&&(s="iOS"),l=r+"	"+n+"	"+a+"	"+i+"	"+o+"	"+t.vastUrl+"	"+t.adId+"	"+t.type+"	"+t.url+"	"+t.status+"	"+t.duration+"	"+s,$.ajax({type:"POST",url:e.LOG_URL,dataType:"jsonp",data:{param:l},jsonp:"jsonpcallback",success:function(){}})}},new t});