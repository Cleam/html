$(function(){function t(){this.qid=GLOBAL.Util.getQueryString("qid")||Cookies.get("qid")||"",this.userId="",this.osType=GLOBAL.Util.getOsType(),this.browserType=GLOBAL.Util.getBrowserType(),this.init()}var e="http://toutiao.eastday.com/getwapdata/getuid",a="http://toutiao.eastday.com/getwapdata/data",o="http://toutiao.eastday.com/getwapdata/videoact",i="http://toutiao.eastday.com/pjson/morevideos",n="http://ot.dftoutiao.com/online/online",r=10;t.prototype.init=function(){var t=this;t.qid?t._setQid(t.qid):Cookies.remove("qid",{path:"/",domain:"eastday.com"}),t.userId=t._getUid(),t.userId||t._setUid(),t.addVideoListener($("#J_video")),t.getVideoList(),t._addLog(),t._addOnlineLog(),setInterval(function(){t._addOnlineLog()},1e3*r)},t.prototype.getVideoList=function(t){var e=this;$.ajax({url:i,data:{type:$("#J_video").attr("data-type"),num:"10",qid:e.qid,recgid:e.userId,url:GLOBAL.Util.getUrlNoParams()},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){},success:function(t){e.generateVideoList(t)},error:function(t){console.error(t)},complete:function(){t&&t()}})},t.prototype.generateVideoList=function(t){var e=this,a=t.data?t.data:null,o=a?a.length:0,i=$("#J_related"),n=$('<div class="related-cnt"></div>');if(o>0){i.append('<div class="related-tit"><h2>相关视频</h2></div>');for(var r=0;o>r;r++){var d=a[r],s=d.miniimg_01,l=s[0],p=r+1,u=GLOBAL.Util.getUrlNoParams(),c=d.url+"?qid="+e.qid+"&idx="+p+"&fr="+u,y=d.type,g=d.topic,m=d.source,f=l.src,h=l.imgwidth,v=l.imgheight,L=GLOBAL.Util.msToTimestr(d.videoalltime);n.append('<section class="news-item news-item-video"><a data-type="'+y+'" data-subtype="" href="'+c+'"><div class="news-wrap clearfix"><div class="txt-wrap fl"><h3>'+g+'</h3> <p><em class="fl">'+m+'</em></p></div><div class="img-wrap fr"><img class="lazy" src="'+f+'" alt="" data-width="'+h+'" data-height="'+v+'"><span class="duration">'+L+"</span></div></div></a></section>")}}n.appendTo(i)},t.prototype.sendVideoLog=function(t){t&&$.ajax({url:o,data:{param:encodeURIComponent(t)},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){}})},t.prototype.addVideoListener=function(t){var e=this;t.on("playing",function(t){try{var a=$(t.target),o=a[0],i=o.currentSrc,n=o.duration?Math.floor(1e3*o.duration):a.attr("data-duration"),r=a.attr("data-idx"),d=a.attr("data-type"),s=a.attr("data-playingTime")?a.attr("data-playingTime"):"null",l=Math.floor(1e3*o.currentTime),p=e.qid+"	"+e.userId+"	news	eastday_wapnews	null	"+(d||"null")+"	"+e.osType+"	"+(r||"null")+"	"+e.browserType+"	"+i+"	"+n+"	"+s+"	"+l+"	play";a.attr("data-updateTime",+new Date),e.sendVideoLog(p)}catch(u){console.log("Event playing has error!!!",u)}}),t.on("pause",function(t){try{var a=$(t.target),o=a[0],i=o.currentSrc,n=o.duration?Math.floor(1e3*o.duration):a.attr("data-duration"),r=a.attr("data-idx"),d=a.attr("data-type"),s=a.attr("data-playingTime")?a.attr("data-playingTime"):"null",l=Math.floor(1e3*o.currentTime),p=e.qid+"	"+e.userId+"	news	eastday_wapnews	null	"+d+"	"+e.osType+"	"+(r||"null")+"	"+e.browserType+"	"+i+"	"+n+"	"+s+"	"+l+"	pause";e.sendVideoLog(p)}catch(u){console.log("Event pause has error!!!",u)}}),t.on("timeupdate",function(t){try{var e=$(t.target),a=e[0],o=(a.duration,a.currentTime,parseInt(e.attr("data-updateTime"),10)||+new Date),i=parseInt(e.attr("data-playingTime"),10)||0,n=+new Date;i=i+n-o,e.attr("data-playingTime",i),e.attr("data-updateTime",n)}catch(r){console.log("Event timeupdate has error!!!",r)}})},t.prototype._addLog=function(){var t=GLOBAL.Util.getPixel(),e=this;$.ajax({url:a,data:{qid:e.qid||"null",uid:e.userId||"null",softtype:"news",softname:"eastday_wapnews",newstype:$("#J_video").attr("data-type")||"null",from:GLOBAL.Util.getQueryString("fr")||"null",to:GLOBAL.Util.getUrlNoParams()||"null",os_type:e.osType||"null",browser_type:e.browserType||"null",pixel:t.w+"*"+t.h,fr_url:GLOBAL.Util.getReferrer()||"null",loginid:"null",ime:"null",idx:GLOBAL.Util.getQueryString("idx"),ishot:"null",ver:"null",appqid:"null",ttloginid:"null",apptypeid:"null",appver:"null",recommendtype:"null",ispush:"null"},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){console.error(arguments)}})},t.prototype._addOnlineLog=function(){var t=this,e=GLOBAL.Util.getUrlNoParams()+"	"+t.userId+"	"+t.qid+"	null	null	null	"+($("#J_video").attr("data-type")||"null")+"	"+r+"	null	null	"+t.osType+"	null";$.ajax({url:n,data:{param:encodeURI(e)},dataType:"jsonp",jsonp:"jsonpcallback"})},t.prototype._setQid=function(t){t&&Cookies.set("qid",t,{expires:3,path:"/",domain:"eastday.com"})},t.prototype._getQid=function(t){var t=Cookies.get("qid");return t?t:""},t.prototype._setUid=function(t){var a=this;$.ajax({url:e,dataType:"jsonp",data:{softtype:"news",softname:"eastday_wapnews"},jsonp:"jsonpcallback",success:function(t){try{a.userId=t.uid,Cookies.set("user_id",a.userId,{expires:365,path:"/",domain:"eastday.com"})}catch(e){console.error(e)}},error:function(t){console.error(t)}})},t.prototype._getUid=function(t){var e=Cookies.get("user_id");return e?e:""},new t});