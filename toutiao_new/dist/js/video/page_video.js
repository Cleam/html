$(function(){function t(){this.qid=GLOBAL.Util.getQueryString("qid")||Cookies.get("qid")||"",this.userId="",this.osType=GLOBAL.Util.getOsType(),this.browserType=GLOBAL.Util.getBrowserType(),this.init()}var e="http://123.59.60.170/getwapdata/getuid",a="http://123.59.60.170/getwapdata/data",i="http://123.59.60.170/getwapdata/videoact",r="http://123.59.62.164/pjson/morevideos";t.prototype.init=function(){var t=this;t.qid?t._setQid(t.qid):Cookies.remove("qid",{path:"/",domain:"eastday.com"}),t.userId=t._getUid(),t.userId||t._setUid(),t.addVideoListener($("#J_video")),t.getVideoList(),t.addLog()},t.prototype.getVideoList=function(t){var e=this;$.ajax({url:r,data:{type:$("#J_video").attr("data-type"),num:"10",url:GLOBAL.Util.getUrlNoParams()},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){},success:function(t){e.generateVideoList(t)},error:function(t){console.error(t)},complete:function(){t&&t()}})},t.prototype.generateVideoList=function(t){var e=this,a=t.data?t.data:null,i=a?a.length:0,r=$("#J_related"),o=$('<div class="related-cnt"></div>');if(i>0){r.append('<div class="related-tit"><h2>相关视频</h2></div>');for(var n=0;i>n;n++){var s=a[n],d=s.miniimg_01,l=d[0],p=n+1,u=GLOBAL.Util.getUrlNoParams(),c=s.url+"?qid="+e.qid+"&idx="+p+"&fr="+u,y=s.type,g=s.topic,m=s.source,f=l.src,h=l.imgwidth,v=l.imgheight,w=GLOBAL.Util.msToTimestr(s.videoalltime);o.append('<section class="news-item news-item-video"><a data-type="'+y+'" data-subtype="" href="'+c+'"><div class="news-wrap clearfix"><div class="txt-wrap fl"><h3>'+g+'</h3> <p><em class="fl">'+m+'</em></p></div><div class="img-wrap fr"><img class="lazy" src="'+f+'" alt="" data-width="'+h+'" data-height="'+v+'"><span class="duration">'+w+"</span></div></div></a></section>")}}o.appendTo(r)},t.prototype.sendVideoLog=function(t){t&&$.ajax({url:i,data:{param:encodeURIComponent(t)},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){}})},t.prototype.addVideoListener=function(t){var e=this;t.on("playing",function(t){try{var a=$(t.target),i=a[0],r=i.currentSrc,o=i.duration?Math.floor(1e3*i.duration):a.attr("data-duration"),n=a.attr("data-idx"),s=a.attr("data-type"),d=a.attr("data-playingTime")?a.attr("data-playingTime"):"null",l=Math.floor(1e3*i.currentTime),p=e.qid+"	"+e.userId+"	news	eastday_wapnews	null	"+(s||"null")+"	"+e.osType+"	"+(n||"null")+"	"+e.browserType+"	"+r+"	"+o+"	"+d+"	"+l+"	play";a.attr("data-updateTime",+new Date),e.sendVideoLog(p)}catch(u){console.log("Event playing has error!!!",u)}}),t.on("pause",function(t){try{var a=$(t.target),i=a[0],r=i.currentSrc,o=i.duration?Math.floor(1e3*i.duration):a.attr("data-duration"),n=a.attr("data-idx"),s=a.attr("data-type"),d=a.attr("data-playingTime")?a.attr("data-playingTime"):"null",l=Math.floor(1e3*i.currentTime),p=e.qid+"	"+e.userId+"	news	eastday_wapnews	null	"+s+"	"+e.osType+"	"+(n||"null")+"	"+e.browserType+"	"+r+"	"+o+"	"+d+"	"+l+"	pause";e.sendVideoLog(p)}catch(u){console.log("Event pause has error!!!",u)}}),t.on("timeupdate",function(t){try{var e=$(t.target),a=parseInt(e.attr("data-updateTime"),10)||+new Date,i=parseInt(e.attr("data-playingTime"),10)||0,r=+new Date;i=i+r-a,e.attr("data-playingTime",i),e.attr("data-updateTime",r)}catch(o){console.log("Event timeupdate has error!!!",o)}})},t.prototype.addLog=function(){var t=GLOBAL.Util.getPixel(),e=this;$.ajax({url:a,data:{qid:e.qid||"null",uid:e.userId||"null",softtype:"news",softname:"eastday_wapnews",newstype:"null",from:GLOBAL.Util.getQueryString("fr")||"null",to:GLOBAL.Util.getUrlNoParams()||"null",os_type:e.osType||"null",browser_type:e.browserType||"null",pixel:t.w+"*"+t.h,fr_url:GLOBAL.Util.getReferrer()||"null",loginid:"null",ime:"null",idx:GLOBAL.Util.getQueryString("idx"),ishot:"null",ver:"null",appqid:"null",ttloginid:"null",apptypeid:"null",appver:"null",recommendtype:"null",ispush:"null"},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){console.error(arguments)}})},t.prototype._setQid=function(t){t&&Cookies.set("qid",t,{expires:3,path:"/",domain:"eastday.com"})},t.prototype._getQid=function(t){var t=Cookies.get("qid");return t?t:""},t.prototype._setUid=function(t){var a=this;$.ajax({url:e,dataType:"jsonp",data:{softtype:"news",softname:"eastday_wapnews"},jsonp:"jsonpcallback",success:function(t){try{a.userId=t.uid,Cookies.set("user_id",a.userId,{expires:365,path:"/",domain:"eastday.com"})}catch(e){console.error(e)}},error:function(t){console.error(t)}})},t.prototype._getUid=function(t){var e=Cookies.get("user_id");return e?e:""},new t});