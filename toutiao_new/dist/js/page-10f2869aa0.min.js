$(function(){function e(){var e=GLOBAL.Util.getQueryString("type"),a=e?e:wsCache.get("current_newstype");this.newsType=a?a:"toutiao",this.vnewsType=wsCache.get("vnewstype")||"vtuijian",this.readUrl="",this.userId=Cookies.get("user_id"),this.idx=0,this.pgNum=1,this.pulldown_pgNum=0,this.pulldown_idx=0,this.pulldown_num=0,this.qid=GLOBAL.Et.qid||GLOBAL.Util.getQueryString("qid")||Cookies.get("qid"),this.pullUpFlag=!0,this.startKey={},this.endKey={},this.osType=GLOBAL.Util.getOsType(),this.browserType=GLOBAL.Util.getBrowserType(),this.init()}FastClick.attach(document.body);var a="http://mini.eastday.com/toutiaoh5/data/channels.json",t="http://toutiao.eastday.com/toutiao_h5/RefreshJP",s="http://toutiao.eastday.com/toutiao_h5/pulldown",n="http://toutiao.eastday.com/toutiao_h5/NextJP",o="http://toutiao.eastday.com/toutiao_h5/videopool",r="http://toutiao.eastday.com/toutiao_h5/videopool",l="http://toutiao.eastday.com/toutiao_h5/videopool",d="http://position.dfshurufa.com/position/get",c="http://toutiao.eastday.com/getwapdata/getuid",p="http://toutiao.eastday.com/pjson/zan",u="http://toutiao.eastday.com/getwapdata/data",h="http://ot.dftoutiao.com/online/online",g="http://toutiao.eastday.com/getwapdata/advshow",m="http://toutiao.eastday.com/getwapdata/ad",w="http://toutiao.eastday.com/getwapdata/videoact",v=$("body"),y=[],f=[],T=$("#J_news_list"),_=$("#J_refresh"),x=$("#J_top_menu");$("#J_gg_baidu_id"),$("#J_gg_sogou_id");praiseTrampleFlag=!0,startPos=0,touchDistance=0,touchDistanceFlag=!0,isSwipeDown=!1,isTop=!1,$pullDownLoading=null,TOUCH_DISTANCE=150,pullDownLoadDataTimer=null,wsCache=new WebStorageCache,onlineTimer=null,isThanAndroid4=!0,videoCtg=[{name:"推荐",value:"vtuijian"},{name:"搞笑",value:"vgaoxiao"},{name:"拍客",value:"vpaike"},{name:"资讯",value:"vzixun"},{name:"纪录片",value:"vjilupian"},{name:"公益",value:"vgongyi"},{name:"体育",value:"vtiyu"},{name:"汽车",value:"vqiche"},{name:"科技",value:"vkeji"},{name:"财经",value:"vcaijing"},{name:"娱乐",value:"vyule"},{name:"原创",value:"vyuanchuang"},{name:"旅游",value:"vlvyou"},{name:"时尚",value:"vshishang"},{name:"亲子",value:"vqinzi"},{name:"教育",value:"vjiaoyu"},{name:"游戏",value:"vyouxi"},{name:"生活",value:"vshenghuo"}],tempVideoCtg=[],baiduGgId="",sogouGgId="",gdtGgId="";try{navigator.userAgent.indexOf("Android")>=0&&Number(GLOBAL.Util.getOsType().split(" ")[1])<4.1&&(isThanAndroid4=!1)}catch(C){console.error(C)}e.prototype={init:function(){function e(e,t,s){var i=e.data("rowkey"),n=a.getPraiseTrampleStatus(i);return 1===n?void alert("您已经赞过了！"):-1===n?void alert("您已经踩过了！"):void(praiseTrampleFlag&&(praiseTrampleFlag=!1,e.addClass("active").text(Number(e.text())+1),$.ajax({url:p,dataType:"jsonp",data:{colname:t,rowkey:i,praisecnt:1},jsonp:"jsonpcallback",success:function(e){a.cachePraiseTrampleRowkey(s,i),praiseTrampleFlag=!0},error:function(e){console.error(e)}})))}var a=this;a.setGgId(),a.qid?a.setQid(a.qid):Cookies.remove("qid",{path:"/",domain:"eastday.com"}),a.userId||(a.userId=+new Date+Math.random().toString(10).substring(2,6),Cookies.set("user_id",a.userId,{expires:365,path:"/",domain:"eastday.com"})),a.readUrl=wsCache.get("read_url_all"),a.readUrl||(a.readUrl=""),a.initChannels(function(){var e=x.children("a");e.each(function(){var e=$(this),a=e.data("type");y.push(a),"meinv"!==a&&"nuanwen"!==a||f.push(a)}),e.eq(2).after('<a data-type="shipin">视频</a>'),wsCache.get("location")?a.updateDomLocation(wsCache.get("location")):a.location(),x.children("a").each(function(){var e=$(this);return e.data("type")==a.newsType?(setTimeout(function(){a.scrollTo(e,!1)},50),!1):void 0})}),a.refreshData(function(){a.highlightPraiseTrample()}),"1"!==Cookies.get("FROM_DETAILS_MORE_NEWS")&&(a.addLog(),Cookies.remove("FROM_DETAILS_MORE_NEWS",{path:"/",domain:"eastday.com"})),a.pullDown(),x.on("click","a",function(){var e=$(this),t=e.data("type");e.hasClass("active")||(a.scrollTo(e,!1),wsCache.set("prev_newstype",a.newsType,{exp:1200}),wsCache.set("current_newstype",t,{exp:1200}),a.newsType=t,a.refreshData(function(){a.highlightPraiseTrample()}),a.addLog())}),$(window).on("scroll",function(){var e=GLOBAL.Util.getScrollTop(),t=$("#J_loading").offset().top,s=GLOBAL.Util.getClientHeight(),i=null;i&&clearTimeout(i),i=setTimeout(function(){wsCache.set("news_pos_"+a.newsType,e,{exp:1200})},200),t>=s&&e+s>=t&&a.pullUpFlag&&a.pullUpLoadData(),T.find("video").each(function(){var e=$(this),a=e.offset().top,t=v.scrollTop();(t>=a||a-t>=$(window).height()-e.height())&&(this.paused||this.pause())})}),_.on("click",function(){_.hasClass("active")||a.reloadData()}),T.on("click","a",function(e){var t=$(this),s=t.attr("href").split("?")[0];s=s.substring(s.lastIndexOf("/")+1,s.indexOf(".html")),a.cacheReadUrl(s,t.data("type"),t.data("subtype")),T.find("video").each(function(){this.paused||this.pause()})}),v.on("click",".J-read-position",function(){v.scrollTop(0),a.changeRefreshStatus(),a.pullDownLoadData()}),v.on("click",".J-promote-news",function(){var e=$(this),t=e.attr("href"),s=e.data("advid");a.sendPromoteNewslog(t,s)}),v.on("click",".J-video-ctg",function(){a.vnewsType=$(this).attr("data-type"),wsCache.set("vnewstype",a.vnewsType,{exp:1200}),T.empty(),a.reloadData()}),T.on("click",".J-good",function(){e($(this),"z0000",1)}),T.on("click",".J-bad",function(){e($(this),"zd0000",-1)}),a.addOnlineLog(),onlineTimer=setInterval(function(){a.addOnlineLog()},1e4),setTimeout(function(){clearInterval(onlineTimer)},6e5)},reloadData:function(){var e=this;e.changeRefreshStatus(),wsCache["delete"]("news_pos_"+e.newsType),wsCache["delete"]("news_"+e.newsType),wsCache.set("pulldown_pgnum_"+e.newsType,0,{exp:86400}),e.refreshData(function(){e.highlightPraiseTrample()})},changeRefreshStatus:function(){_.addClass("active"),setTimeout(function(){_.removeClass("active")},700)},initChannels:function(e){var t=this,s=wsCache.get("news_channels");s?(t.generateChannelTabs(s),e&&e()):$.ajax({url:a,dataType:"json",success:function(a){t.generateChannelTabs(a.channels.up),e&&e()},error:function(){console.error(arguments)}})},sendPromoteNewslog:function(e,a){var t=this,s=GLOBAL.Util.getPixel();$.ajax({url:m,dataType:"jsonp",data:{qid:t.qid||"null",uid:t.userId||"null",loginid:"null",softtype:"news",softname:"eastday_wapnews",newstype:"ad",from:"null",to:e||"null",os_type:t.osType||"null",browser_type:t.browserType||"null",pixel:s.w+"*"+s.h,ime:"null",fr_url:GLOBAL.Util.getUrlNoParams()||"null",adv:a||"null"},jsonp:"jsonpcallback",success:function(e){}})},generateChannelTabs:function(e){if(e&&e instanceof Array){var a="",t=0;try{if(!isThanAndroid4)for(t=0;t<e.length;t++)"shipin"===e[t].name&&e.splice(t,1)}catch(s){console.error(s)}for(t=0;t<e.length;t++)a+=0===t?'<a class="active" data-type="'+e[t].name+'">'+e[t].value+"</a>":'<a data-type="'+e[t].name+'">'+e[t].value+"</a>";x.html(a),""+wsCache.get("custom_channels")=="1"&&wsCache.set("news_channels",e)}},getMyChannels:function(e,a){if(!e||!a)return[];for(var t=[],s=a.length,i=e.length,n=0;s>n;n++)for(var o=0;i>o;o++)a[n].name===e[o].name&&t.push(a[n]);return t},pullDown:function(){var e=this,a=0;T.on("touchstart",function(e){clearTimeout(pullDownLoadDataTimer),startPos=e.touches[0].pageY,v.scrollTop()<=0?isTop=!0:isTop=!1,$pullDownLoading?$pullDownLoading.removeClass("active").css({display:"block",opacity:0,top:a,transform:"translateY(0px)","-webkit-transform":"translateY(0px)"}):(a=$("header").height()-40,$pullDownLoading=$('<svg id="J_svg" class="svg" style="top: '+a+'px"><g id="J_svg_g"><marker id="J_svg_marker" markerWidth="10" markerHeight="10" refX="0" refY="5" orient="auto" markerUnits="userSpaceOnUse"><path d="M0,0 L0,10 L5,5 L0,0" style="fill: #d43d3d;"></path></marker><path stroke-width="3.5" stroke-linecap="round" id="J_svg_path" marker-end="url(#J_svg_marker)" d="M20,9 A11,11 0 1,1 10.5,14.5" style="stroke: #d43d3d; fill: none;"></path><circle id="J_svg_circle" class="path" fill="none" stroke-width="3.5" stroke-linecap="round" cx="25" cy="25" r="11"></circle></g></svg>'))}),T.on("touchend",function(){isSwipeDown&&(touchDistance>=TOUCH_DISTANCE?$pullDownLoading.animate({top:a+TOUCH_DISTANCE/3+"px"},"fast",function(){$pullDownLoading&&$pullDownLoading.addClass("active"),clearTimeout(pullDownLoadDataTimer),pullDownLoadDataTimer=setTimeout(function(){"meinv"===e.newsType?$pullDownLoading&&$pullDownLoading.remove():(e.changeRefreshStatus(),e.pullDownLoadData(function(){setTimeout(function(){$pullDownLoading&&$pullDownLoading.fadeOut("fast",function(){$pullDownLoading.remove()})},500)}))},200)}):$pullDownLoading&&$pullDownLoading.animate({opacity:0,top:a},"fast",function(){$pullDownLoading.remove()})),touchDistanceFlag=!0,isSwipeDown=!1}),T.on("touchmove",function(e){var t=e.touches[0].pageY;touchDistance=t-startPos,isTop&&touchDistanceFlag&&touchDistance>0&&(isSwipeDown=!0,touchDistanceFlag=!1),isTop&&isSwipeDown&&(0===v.find(".svg").length&&$pullDownLoading.appendTo("body"),touchDistance>=TOUCH_DISTANCE?($pullDownLoading.find("#J_svg_marker>path").attr("style","fill:#2a90d7"),$pullDownLoading.find("#J_svg_g>path").attr("style","stroke:#2a90d7;fill:none"),touchDistance>=TOUCH_DISTANCE+80&&(touchDistance=TOUCH_DISTANCE+80)):($pullDownLoading.find("#J_svg_marker>path").attr("style","fill:#d43d3d"),$pullDownLoading.find("#J_svg_g>path").attr("style","stroke:#d43d3d;fill:none")),$pullDownLoading.css({opacity:touchDistance/TOUCH_DISTANCE,transform:"rotate("+touchDistance/TOUCH_DISTANCE*720+"deg)","-webkit-transform":"rotate("+touchDistance/TOUCH_DISTANCE*720+"deg)",top:a+touchDistance/3+"px"}),e.preventDefault())})},pullDownLoadData:function(e){var a=this;a.pulldown_pgNum=Number(wsCache.get("pulldown_pgnum_"+a.newsType)),wsCache.set("pulldown_pgnum_"+a.newsType,--a.pulldown_pgNum,{exp:86400}),a.pulldown_idx=Number(wsCache.get("pulldown_idx_"+a.newsType)),a.pulldown_idx||(a.pulldown_idx=0),"shipin"!==a.newsType?(a.readUrl=a.getNewsReadUrl(),a.pullDownLoadNewsData(e)):(a.readUrl=a.getVideoReadUrl(),a.pullDownLoadVideoData(e))},pullDownLoadNewsData:function(e){var a=this;$.ajax({url:s,data:{type:a.newsType,startkey:wsCache.get("startkey_"+a.newsType)?wsCache.get("startkey_"+a.newsType):a.startKey[a.newsType],lastkey:wsCache.get("endkey_"+a.newsType)?wsCache.get("endkey_"+a.newsType):a.endKey[a.newsType],pgnum:a.pulldown_pgNum,idx:a.pulldown_idx,readhistory:a.readUrl,recgid:a.userId,qid:a.qid,os:a.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){},success:function(e){a.generateDomForPulldown(e)},error:function(e){console.error(e)},complete:function(){e&&e()}})},pullDownLoadVideoData:function(e){var a=this;$.ajax({url:r,data:{type:a.vnewsType,startkey:wsCache.get("startkey_"+a.newsType)?wsCache.get("startkey_"+a.newsType):a.startKey[a.newsType],lastkey:wsCache.get("endkey_"+a.newsType)?wsCache.get("endkey_"+a.newsType):a.endKey[a.newsType],pgnum:a.pulldown_pgNum,idx:a.pulldown_idx,readhistory:a.readUrl,recgid:a.userId,qid:a.qid,os:a.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){},success:function(e){a.generateVideoDomForPulldown(e)},error:function(e){console.error(e)},complete:function(){e&&e()}})},getNewsReadUrl:function(){var e=this,a="";return a="toutiao"===e.newsType||"weikandian"===e.newsType?wsCache.get("read_url_all"):wsCache.get("read_url_"+e.newsType),a?a:null},getVideoReadUrl:function(){var e=this,a="";return a="vtuijian"===e.vnewsType?wsCache.get("video_read_url_all"):wsCache.get("video_read_url_"+e.vnewsType),a?a:null},generateDomForPulldown:function(e){var a=this,t=e&&e.data,s=t.length,i=!1,n=0,o=3,r=s;if(!t||!t.length)return!1;a.pulldown_num++,a.startKey[a.newsType]=e.endkey,wsCache.set("startkey_"+a.newsType,e.endkey,{exp:86400}),a.endKey[a.newsType]=e.newkey,wsCache.set("endkey_"+a.newsType,e.newkey,{exp:86400}),t.reverse(),v.find(".J-read-position").remove(),T.prepend('<a class="J-read-position read-position">上次浏览到这里，点击刷新。</a>'),s>4&&8>s?(n=0,o=3):s>8&&(n=s-8,o=s-5),r=Math.floor((o-n+1)*Math.random()+n);for(var l=0;s>l;l++){var d=t[l],c=d.url,p=d.date,u=d.topic,h=d.source,g=d.miniimg,m=d.recommendtype?d.recommendtype:"-1",w=d.hotnews,y=d.ispicnews,f=d.videonews,_=d.videolist,x=d.isadv||"",C=d.adv_id||"",L=d.type,b=d.subtype,D=g.length,k=Number(d.hotnews),U=Number(d.isvideo),j=Number(d.isrecom),G=Number(d.isnxw),A="",S="";if("1"==x?(S="&nbsp;",A='class="J-promote-news" data-advid="'+C+'"',a.sendAdShowLog(C,c)):k?(S='<i class="hot">热门</i>',U&&(S+='<i class="video">视频</i>')):j?S='<i class="rec">推荐</i>':U?S='<i class="video">视频</i>':G&&(S='<i class="nuanwen">暖文</i>'),c+="meinv"==a.newsType?"?fr=meinv&#&gid=1&pid=1":"?idx="+(a.pulldown_idx-l-1)+"&recommendtype="+m+"&ishot="+w+"&fr="+a.newsType,i||l!==r||(a.insertGgForPullDown(),i=!0),"1"==f){if(isThanAndroid4){var O=d.lbimg[0]?d.lbimg[0].src:"",I=$('<section class="news-item news-item-video"><div class="video-wrap"><h3>'+u+'</h3><div class="J-video-box video-box"><video controls="auto" data-type="'+L+'" data-idx="'+(a.idx+l+1)+'" poster="'+O+'" autobuffer="true" preload="none"><source src="'+_[0].src+'" type="video/mp4">您的浏览器不支持该视频播放。</video></div><p class="clearfix"><em class="fl"><i class="video">视频</i></em><em class="fr">'+h+"</em></p></div></section>");T.prepend(I)}}else"2"==f?isThanAndroid4&&T.prepend('<section class="news-item news-item-video-link"><a '+A+' data-type="'+L+'" data-subtype="'+b+'" href="'+c+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+u+'</h3> <p><em class="fl"><i class="video">视频</i></em><em class="fr">'+h+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+g[0].src+'"><span class="play-btn"></span></div></div></a></section>'):"1"==y?(g=d.lbimg,T.prepend('<section class="pull-down news-item news-item-s3"><a '+A+' data-type="'+L+'" data-subtype="'+b+'" href="'+c+'"><div class="news-wrap"><h3>'+u+'</h3><div class="img-wrap clearfix"><img class="lazy fl" src="'+g[0].src+'" alt="'+g[0].alt+'"></div><p class="clearfix"><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(p))+'</em><em class="fr">'+h+"</em></p></div></a></section>")):"-1"==y?T.prepend('<section class="news-item news-item-noimg"><a '+A+' data-type="'+L+'" data-subtype="'+b+'" href="'+c+'"><div class="news-wrap"><h3>'+u+'</h3><p class="clearfix"><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(p))+'</em><em class="fr">'+h+"</em></p></div></a></section>"):"0"==y&&(D>=3?T.prepend('<section class="pull-down news-item news-item-s2"><a '+A+' data-type="'+L+'" data-subtype="'+b+'" href="'+c+'"><div class="news-wrap"><h3>'+u+'</h3><div class="img-wrap clearfix"><div class="img fl"><img class="lazy" src="'+g[0].src+'" alt="'+g[0].alt+'"></div><div class="img fl"><img class="lazy" src="'+g[1].src+'" alt="'+g[1].alt+'"></div><div class="img fl"><img class="lazy" src="'+g[2].src+'" alt="'+g[2].alt+'"></div></div><p class="clearfix"><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(p))+'</em><em class="fr">'+h+"</em></p></div></a></section>"):T.prepend('<section class="pull-down news-item news-item-s1"><a '+A+' data-type="'+L+'" data-subtype="'+b+'" href="'+c+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+u+'</h3> <p><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(p))+'</em><em class="fr">'+h+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+g[0].src+'" alt="'+g[0].alt+'"></div></div></a></section>'))}var N=$('<p id="J_recommend_news" class="recommend-news">为您推荐<span>'+s+"</span>条新闻</p>");if(N.appendTo("body"),setTimeout(function(){N.animate({scale:0,opacity:.5},"600",function(){N.remove()})},1200),a.pulldown_num>=20){a.pulldown_num=0;for(var J=T.children(),V=J.length,l=V-1;l>=V-20;l--)J[l].remove()}wsCache.set("pulldown_idx_"+a.newsType,a.pulldown_idx-s,{exp:1200}),setTimeout(function(){T.children().removeClass("pull-down"),wsCache.set("news_"+a.newsType,T.html(),{exp:1200})},400),T.find("video").each(function(e,t){a.setVideoWidthAndHeight($(this)),a.addVideoListener($(this))})},insertGgForPullDown:function(){var e=this,a="",t="",s="";gdtGgId?(t="gdt_"+(+new Date+Math.random().toString(10).substring(2,6)),a='<div class="gg-wrap"><iframe id="'+t+'" name="iframe" src="gg/gg_gdt.html?qid='+e.qid+"&uid="+e.userId+"&ggid="+gdtGgId+"&iframeid="+t+'" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" width="100%" height="100%"></iframe></div>'):!baiduGgId&&sogouGgId?a='<div class="gg-wrap"><iframe src="gg/gg_sogou.html?ggid='+sogouGgId+'" frameborder="0" scrolling="no" width="100%" height="78"></iframe></div>':(s="shipin"!==e.newsType?120:78,a='<div class="gg-wrap"><iframe src="gg/gg_baidu.html?ggid='+baiduGgId+"&channeltype="+e.newsType+'" frameborder="0" scrolling="no" width="100%" height="'+s+'"></iframe></div>'),T.prepend(a)},generateVideoDomForPulldown:function(e){var a=this,t=e.data?e.data:null,s=!1,i=!1,n=t?t.length:0,o=0,r=3,l=n;if(!t||!n)return!1;a.pulldown_num++,a.startKey[a.newsType]=e.endkey,wsCache.set("startkey_"+a.newsType,e.endkey,{exp:86400}),a.endKey[a.newsType]=e.newkey,wsCache.set("endkey_"+a.newsType,e.newkey,{exp:86400}),t.reverse(),v.find(".J-read-position").remove(),T.prepend('<a class="J-read-position read-position">上次浏览到这里，点击刷新。</a>'),n>4&&8>n?(o=0,r=3):n>8&&(o=n-8,r=n-5),l=Math.floor((r-o+1)*Math.random()+o);for(var d=0;n>d;d++){var c=t[d],p=c.miniimg,u=p[0],h=c.hotnews,g=c.recommendtype?c.recommendtype:"-1",m=c.date,w=c.type,y=c.topic,f=c.source,_=u.src,x=u.imgwidth,C=u.imgheight,L=Number(c.hotnews),b=Number(c.isrecom),D=c.url+"?qid="+a.qid+"&idx="+(a.idx+d+1)+"&recommendtype="+g+"&ishot="+h+"&fr="+GLOBAL.Util.getUrlNoParams(),k=[],U="",j="";L?j='<i class="hot">热门</i>':b&&(j='<i class="rec">推荐</i>'),i||d!==l||(a.insertGgForPullDown(),i=!0),T.prepend('<section class="news-item news-item-video-link"> <a data-type="'+w+'" data-subtype="" href="'+D+'"> <div class="news-wrap clearfix"> <div class="txt-wrap fr"> <h3>'+y+'</h3> <p><em class="fl">'+(j?j:GLOBAL.Util.getSpecialTimeStr(m))+'</em><em class="fr">'+f+'</em></p> </div> <div class="img-wrap fl"> <img class="lazy" src="'+_+'" alt="" data-width="'+x+'" data-height="'+C+'"> <span class="play-btn"></span> </div> </div> </a> </section>'),0===d||d%1!==0||s||(k=a.getRecommendVideoCtg(),U="vjilupian"===a.vnewsType?tempVideoCtg[a.vnewsType].name:tempVideoCtg[a.vnewsType].name+"频道",0!==k.length&&T.prepend('<section class="news-ctg"><div class="video-ctg-wrap"><div class="wrapper clearfix"><span class="fl">'+U+'</span><div class="link-wrap fl"><a class="J-video-ctg" data-type="'+k[0].value+'" href="javascript:;">'+k[0].name+'</a><a class="J-video-ctg" data-type="'+k[1].value+'" href="javascript:;">'+k[1].name+'</a><a class="J-video-ctg" data-type="'+k[2].value+'" href="javascript:;">'+k[2].name+'</a><a class="J-video-ctg" data-type="'+k[3].value+'" href="javascript:;">'+k[3].name+"</a></div></div></div></section>"),s=!0)}var G=$('<p id="J_recommend_news" class="recommend-news">为您推荐<span>'+n+"</span>条新闻</p>");if(G.appendTo("body"),setTimeout(function(){G.animate({scale:0,opacity:.5},"600",function(){G.remove()})},1200),a.pulldown_num>=20){a.pulldown_num=0;for(var A=T.children(),S=A.length,d=S-1;d>=S-20;d--)A[d].remove()}wsCache.set("pulldown_idx_"+a.newsType,a.pulldown_idx-n,{exp:1200}),setTimeout(function(){T.children().removeClass("pull-down"),wsCache.set("news_"+a.newsType,T.html(),{exp:1200})},400)},sendAdShowLog:function(e,a){var t=this,s=GLOBAL.Util.getPixel();$.ajax({url:g,dataType:"jsonp",data:{qid:t.qid||"null",uid:t.userId||"null",loginid:"null",softtype:"news",softname:"eastday_wapnews",newstype:"ad",from:"null",advurl:a||"null",os_type:t.osType||"null",browser_type:t.browserType||"null",fr_url:"null",pixel:s.w+"*"+s.h,ime:"null",adv:e||"null"},jsonp:"jsonpcallback",success:function(e){}})},highlightPraiseTrample:function(){var e=this;"meinv"==e.newsType&&(T.find(".J-good").each(function(){var a=$(this);1===e.getPraiseTrampleStatus(a.data("rowkey"))&&a.addClass("active")}),T.find(".J-bad").each(function(){var a=$(this);-1===e.getPraiseTrampleStatus(a.data("rowkey"))&&a.addClass("active")}))},getPraiseTrampleStatus:function(e){var a=wsCache.get("praise_rowkey"),t=wsCache.get("trample_rowkey");return a&&-1!=a.indexOf(e)?1:t&&-1!=t.indexOf(e)?-1:0},cachePraiseTrampleRowkey:function(e,a){var t=wsCache.get("praise_trample_rowkey"),s=wsCache.get("praise_rowkey"),i=wsCache.get("trample_rowkey");t?t+=","+a:t=a,wsCache.set("praise_trample_rowkey",t,{exp:7200}),1===e?(s?s+=","+a:s=a,wsCache.set("praise_rowkey",s,{exp:7200})):(i?i+=","+a:i=a,wsCache.set("trample_rowkey",i,{exp:7200}))},location:function(){var e=this;$.ajax({url:d,dataType:"jsonp",jsonp:"jsonpcallback",success:function(a){try{var t=a.position,s=e.getCityPinyin(t.provname),i=null;s&&(i={prov_id:t.pro_id,prov_py:s,prov_name:t.provname},e.updateDomLocation(i),wsCache.set("location",i,{exp:2592e3}))}catch(n){console.error(n)}},error:function(e,a){console.error(a)}})},updateDomLocation:function(e){x.children("a").eq(1).after('<a data-type="'+e.prov_py+'">'+e.prov_name+"</a>")},getCityPinyin:function(e){switch(e){case"上海":return"shanghai";case"北京":return"beijing";case"河南":return"henan";case"广东":return"guangdong";default:return null}},cacheReadUrl:function(e,a,t){var s=this;"shipin"!==s.newsType?s.cacheNewsReadUrl(e,a,t):s.cacheVideoReadUrl(e,a,t)},cacheNewsReadUrl:function(e,a,t){var s=this;if(!s.existNewsReadUrl(e)&&!f.contains(a)){var i=wsCache.get("read_url_all");if(i){for(i=i.split(",");i.length>=5;)i.shift();i.push(e),s.readUrl=i.join(",")}else s.readUrl=e;wsCache.set("read_url_all",s.readUrl,{exp:259200});var n=wsCache.get("read_url_"+a);if(n){for(n=n.split(",");n.length>=3;)n.shift();n.push(e),n=n.join(",")}else n=e;if(wsCache.set("read_url_"+a,n,{exp:259200}),t){var o=wsCache.get("read_url_"+t);if(o){for(o=o.split(",");o.length>=3;)o.shift();o.push(e),o=o.join(",")}else o=e;wsCache.set("read_url_"+t,o,{exp:259200})}}},cacheVideoReadUrl:function(e,a,t){var s=this;if(!s.existVideoReadUrl(e)){var i=wsCache.get("video_read_url_all");if(i){for(i=i.split(",");i.length>=5;)i.shift();i.push(e),s.readUrl=i.join(",")}else s.readUrl=e;wsCache.set("video_read_url_all",s.readUrl,{exp:259200});var n=wsCache.get("video_read_url_"+a);if(n){for(n=n.split(",");n.length>=3;)n.shift();n.push(e),n=n.join(",")}else n=e;if(wsCache.set("video_read_url_"+a,n,{exp:259200}),t){var o=wsCache.get("video_read_url_"+t);if(o){for(o=o.split(",");o.length>=3;)o.shift();o.push(e),o=o.join(",")}else o=e;wsCache.set("video_read_url_"+t,o,{exp:259200})}}},existNewsReadUrl:function(e){var a=wsCache.get("read_url_all");return!(!a||-1===a.indexOf(e))},existVideoReadUrl:function(e){var a=wsCache.get("video_read_url_all");return!(!a||-1===a.indexOf(e))},clearPosition:function(e){wsCache["delete"]("news_pos_"+e)},scrollTo:function(e,a){var t=x.children("a"),s=$(window).width(),i=e[0].offsetLeft,n=e.width();t.removeClass("active"),e.addClass("active"),x.scrollLeft(i+n/2-s/2)},setQid:function(e){e&&Cookies.set("qid",e,{expires:3,path:"/",domain:"eastday.com"})},getQid:function(){var e=Cookies.get("qid");return e?e:""},setUid:function(){var e=this;$.ajax({url:c,dataType:"jsonp",data:{softtype:"news",softname:"eastday_wapnews"},jsonp:"jsonpcallback",success:function(a){try{e.userId=a.uid,Cookies.set("user_id",e.userId,{expires:365,path:"/",domain:"eastday.com"})}catch(t){console.error(t)}},error:function(e){console.error(e)}})},getUid:function(){var e=Cookies.get("user_id");return e?e:""},addLog:function(){var e=GLOBAL.Util.getPixel(),a=this;$.ajax({url:u,data:{qid:a.qid||"null",uid:a.userId||"null",softtype:"news",softname:"eastday_wapnews",newstype:a.newsType||"null",from:wsCache.get("prev_newstype")||"null",to:wsCache.get("current_newstype")||"null",os_type:a.osType||"null",browser_type:a.browserType||"null",pixel:e.w+"*"+e.h,fr_url:GLOBAL.Util.getReferrer()||"null",loginid:"null",ime:"null",idx:"null",ishot:"null",ver:"null",appqid:"null",ttloginid:"null",apptypeid:"null",appver:"null",recommendtype:"null",ispush:"null"},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){console.error(arguments)}})},addOnlineLog:function(){var e=this,a=GLOBAL.Util.getUrlNoParams()+"	"+e.userId+"	"+e.qid+"	null	null	null	"+e.newsType+"	10	null	null	"+e.osType+"	null";$.ajax({url:h,data:{param:encodeURI(a)},dataType:"jsonp",jsonp:"jsonpcallback"})},refreshData:function(e){var a=this,t=wsCache.get("news_"+a.newsType),s=wsCache.get("news_pos_"+a.newsType);t?(T.html(t),s&&v.scrollTop(s),e&&e(),T.find("video").each(function(e,t){a.setVideoWidthAndHeight($(this)),a.addVideoListener($(this))})):(wsCache["delete"]("pulldown_idx_"+a.newsType),wsCache.set("pgnum_"+a.newsType,1,{exp:1200}),"shipin"!==a.newsType?(a.readUrl=a.getNewsReadUrl(),a.loadNewsData(e)):(a.readUrl=a.getVideoReadUrl(),a.loadVideoData(e)))},loadNewsData:function(e){var a=this;$.ajax({url:t,data:{type:a.newsType,recgid:a.userId,qid:a.qid,picnewsnum:1,readhistory:a.readUrl,idx:0,pgnum:1,os:a.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){T.html("")},success:function(e){a.idx=0,a.generateDom(e);var t=wsCache.get("news_pos_"+a.newsType);t&&v.scrollTop(t)},complete:function(){e&&e()}})},loadVideoData:function(e){var a=this;$.ajax({url:o,data:{type:a.vnewsType,startkey:"",recgid:a.userId,qid:a.qid,domain:"eastday.com",readhistory:a.readUrl,idx:0,pgnum:1,os:a.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){T.html("")},success:function(e){a.idx=0,a.generateVideoDom(e);var t=wsCache.get("news_pos_"+a.newsType);t&&v.scrollTop(t)},complete:function(){e&&e()}})},pullUpLoadData:function(){var e=this;e.pgNum=Number(wsCache.get("pgnum_"+e.newsType)),wsCache.set("pgnum_"+e.newsType,++e.pgNum,{exp:86400}),e.idx=Number(wsCache.get("idx_"+e.newsType)),e.idx||(e.idx=0),"shipin"!==e.newsType?(e.readUrl=e.getNewsReadUrl(),e.pullUpLoadNewsData()):(e.readUrl=e.getVideoReadUrl(),e.pullUpLoadVideoData())},pullUpLoadNewsData:function(){var e=this;$.ajax({url:n,data:{type:e.newsType,startkey:wsCache.get("startkey_"+e.newsType)?wsCache.get("startkey_"+e.newsType):e.startKey[e.newsType],newsnum:"meinv"==e.newsType?10:20,qid:e.qid,readhistory:e.readUrl,idx:e.idx,recgid:e.userId,pgnum:e.pgNum,os:e.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){e.pullUpFlag=!1},success:function(a){e.generateDom(a)},error:function(e,a){console.error(a)},complete:function(){e.pullUpFlag=!0}})},pullUpLoadVideoData:function(){var e=this;$.ajax({url:l,data:{type:e.vnewsType,newsnum:20,idx:e.idx,startkey:wsCache.get("startkey_"+e.newsType)?wsCache.get("startkey_"+e.newsType):e.startKey[e.newsType],recgid:e.userId,qid:e.qid,domain:"eastday.com",readhistory:e.readUrl,pgnum:e.pgNum,os:e.osType},dataType:"jsonp",jsonp:"jsonpcallback",timeout:8e3,beforeSend:function(){e.pullUpFlag=!1},success:function(a){e.generateVideoDom(a)},error:function(e,a){console.error(a)},complete:function(){e.pullUpFlag=!0}})},generateDom:function(e){var a=this,t=e&&e.data;if(!t||!t.length)return!1;a.startKey[a.newsType]=e.endkey,wsCache.set("startkey_"+a.newsType,e.endkey,{exp:86400});for(var s=t.length,i=0;s>i;i++){var n=t[i],o=n.url,r=n.date,l=n.topic,d=n.source,c=n.miniimg,p=n.recommendtype?n.recommendtype:"-1",u=n.hotnews,h=n.ispicnews,g=n.videonews,m=n.videolist,w=n.adv_id||"",v=n.type,y=n.subtype,f=c.length,_=n.rowkey,x=n.isadv||"",C=Number(n.hotnews),L=Number(n.isvideo),b=Number(n.isrecom),D=Number(n.isnxw),k=n.urlpv,U=n.picnums,j=n.praisecnt,G=n.tramplecnt,A="",S="";if("1"==x?(S="&nbsp;",A='class="J-promote-news" data-advid="'+w+'"',a.sendAdShowLog(w,o)):C?(S='<i class="hot">热门</i>',L&&(S+='<i class="video">视频</i>')):b?S='<i class="rec">推荐</i>':L?S='<i class="video">视频</i>':D&&(S='<i class="nuanwen">暖文</i>'),o+="meinv"==a.newsType?"?fr=meinv&#&gid=1&pid=1":"?idx="+(a.idx+i+1)+"&recommendtype="+p+"&ishot="+u+"&fr="+a.newsType,"meinv"==a.newsType)T.append('<section class="news-item news-item-s4"><a data-type="'+v+'" data-subtype="'+y+'" href="'+o+'"><div class="news-wrap"><h3>'+l+'</h3><div class="img-wrap clearfix"><img class="lazy fl" src="'+c[0].src+'"></div></div></a><div class="options"><span class="num">'+U+' 图</span><span class="view">'+k+'</span><span class="split">|</span><span class="J-good good" data-rowkey="'+_+'">'+j+'</span><span class="J-bad bad" data-rowkey="'+_+'">'+G+"</span></div></section>");else if(a.insertGgForPullUp(i),"1"==g){if(isThanAndroid4){var O=n.lbimg[0].src,I=$('<section class="news-item news-item-video"><div class="video-wrap"><h3>'+l+'</h3><div class="J-video-box video-box"><video controls="auto" data-type="'+v+'" data-idx="'+(a.idx+i+1)+'" poster="'+O+'" autobuffer="true" preload="none"><source src="'+m[0].src+'" type="video/mp4">您的浏览器不支持该视频播放。</video></div><p class="clearfix"><em class="fl"><i class="video">视频</i></em><em class="fr">'+d+"</em></p></div></section>");T.append(I)}}else"2"==g?isThanAndroid4&&T.append('<section class="news-item news-item-video-link"><a '+A+' data-type="'+v+'" data-subtype="'+y+'" href="'+o+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+l+'</h3> <p><em class="fl"><i class="video">视频</i></em><em class="fr">'+d+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+c[0].src+'"><span class="play-btn"></span></div></div></a></section>'):"1"==h?(c=n.lbimg,T.append('<section class="news-item news-item-s3"><a '+A+' data-type="'+v+'" data-subtype="'+y+'" href="'+o+'"><div class="news-wrap"><h3>'+l+'</h3><div class="img-wrap clearfix"><img class="lazy fl" src="'+c[0].src+'"></div><p class="clearfix"><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(r))+'</em><em class="fr">'+d+"</em></p></div></a></section>")):"-1"==h?T.append('<section class="news-item news-item-noimg"><a '+A+' data-type="'+v+'" data-subtype="'+y+'" href="'+o+'"><div class="news-wrap"><h3>'+l+'</h3><p class="clearfix"><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(r))+'</em><em class="fr">'+d+"</em></p></div></a></section>"):"0"==h&&(f>=3?T.append('<section class="news-item news-item-s2"><a '+A+' data-type="'+v+'" data-subtype="'+y+'" href="'+o+'"><div class="news-wrap"><h3>'+l+'</h3><div class="img-wrap clearfix"><div class="img fl"><img class="lazy" src="'+c[0].src+'"></div><div class="img fl"><img class="lazy" src="'+c[1].src+'"></div><div class="img fl"><img class="lazy" src="'+c[2].src+'"></div></div><p class="clearfix"><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(r))+'</em><em class="fr">'+d+"</em></p></div></a></section>"):T.append('<section class="news-item news-item-s1"><a '+A+' data-type="'+v+'" data-subtype="'+y+'" href="'+o+'"><div class="news-wrap clearfix"><div class="txt-wrap fr"><h3>'+l+'</h3> <p><em class="fl">'+(S?S:GLOBAL.Util.getSpecialTimeStr(r))+'</em><em class="fr">'+d+'</em></p></div><div class="img-wrap fl"><img class="lazy" src="'+c[0].src+'"></div></div></a></section>'))}wsCache.set("idx_"+a.newsType,a.idx+s,{exp:1200}),wsCache.set("news_"+a.newsType,T.html(),{exp:1200}),T.find("video").each(function(e,t){a.setVideoWidthAndHeight($(this)),a.addVideoListener($(this))})},insertGgForPullUp:function(e){var a=this,t="",s="",i="",n="";gdtGgId?(i="gdt_"+(+new Date+Math.random().toString(10).substring(2,6)),t='<div class="gg-wrap"><iframe id="'+i+'" name="iframe" src="gg/gg_gdt.html?qid='+a.qid+"&uid="+a.userId+"&ggid="+gdtGgId+"&iframeid="+i+'" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" width="100%" height="100%"></iframe></div>'):(n="shipin"!==a.newsType?120:78,t='<div class="gg-wrap"><iframe src="gg/gg_baidu.html?ggid='+baiduGgId+"&channeltype="+a.newsType+'" frameborder="0" scrolling="no" width="100%" height="'+n+'"></iframe></div>'),sogouGgId&&(s='<div class="gg-wrap"><iframe src="gg/gg_sogou.html?ggid='+sogouGgId+'" frameborder="0" scrolling="no" width="100%" height="78"></iframe></div>'),4===e||16===e?!baiduGgId&&sogouGgId?T.append(s):T.append(t):10===e&&(sogouGgId?T.append(s):T.append(t))},generateVideoDom:function(e){var a=this,t=e.data?e.data:null,s=t?t.length:0;if(!t||!s)return!1;a.startKey[a.newsType]=e.endkey,wsCache.set("startkey_"+a.newsType,e.endkey,{exp:86400});for(var i=0;s>i;i++){var n=t[i],o=n.miniimg,r=o[0],l=(GLOBAL.Util.getUrlNoParams(),
n.date),d=n.type,c=n.topic,p=n.source,u=r.src,h=r.imgwidth,g=r.imgheight,m=n.recommendtype?n.recommendtype:"-1",w=n.hotnews,v=(n.isadv||"",Number(n.hotnews)),y=Number(n.isrecom),f=(GLOBAL.Util.msToTimestr(n.videoalltime),n.url+"?qid="+a.qid+"&idx="+(a.idx+i+1)+"&recommendtype="+m+"&ishot="+w+"&fr="+GLOBAL.Util.getUrlNoParams()),_="",x="",C=[];v?_='<i class="hot">热门</i>':y&&(_='<i class="rec">推荐</i>'),T.append('<section class="news-item news-item-video-link"> <a data-type="'+d+'" data-subtype="" href="'+f+'"> <div class="news-wrap clearfix"> <div class="txt-wrap fr"> <h3>'+c+'</h3> <p><em class="fl">'+(_?_:GLOBAL.Util.getSpecialTimeStr(l))+'</em><em class="fr">'+p+'</em></p> </div> <div class="img-wrap fl"> <img class="lazy" src="'+u+'" alt="" data-width="'+h+'" data-height="'+g+'"> <span class="play-btn"></span> </div> </div> </a> </section>'),a.insertGgForPullUp(i),0!==i&&(i+1)%10===0&&(C=a.getRecommendVideoCtg(),x="vjilupian"===a.vnewsType?tempVideoCtg[a.vnewsType].name:tempVideoCtg[a.vnewsType].name+"频道",0!==C.length&&T.append('<section class="news-ctg"><div class="video-ctg-wrap"><div class="wrapper clearfix"><span class="fl">'+x+'</span><div class="link-wrap fl"><a class="J-video-ctg" data-type="'+C[0].value+'" href="javascript:;">'+C[0].name+'</a><a class="J-video-ctg" data-type="'+C[1].value+'" href="javascript:;">'+C[1].name+'</a><a class="J-video-ctg" data-type="'+C[2].value+'" href="javascript:;">'+C[2].name+'</a><a class="J-video-ctg" data-type="'+C[3].value+'" href="javascript:;">'+C[3].name+"</a></div></div></div></section>"))}wsCache.set("idx_"+a.newsType,a.idx+s,{exp:1200}),wsCache.set("news_"+a.newsType,T.html(),{exp:1200})},getRecommendVideoCtg:function(){tempVideoCtg=this.getTempVideoCtg();var e=this,a=tempVideoCtg.length,t=Math.floor(a/4),s=a,n=1,o=0,r=[];for(i=0;i<4;i++)n=t*i,s=t*(i+1),o=Math.floor((s-n)*Math.random()+n),0===i&&"vtuijian"!==e.vnewsType&&(o=0),r[i]=tempVideoCtg[o];return"vtuijian"!==e.vnewsType?r:GLOBAL.Util.dislocateArr(r)},getTempVideoCtg:function(){var e=this,a=0,t=[],s=videoCtg.length;for(a=0;s>a;a++)videoCtg[a].value!==e.vnewsType?t.push(videoCtg[a]):t[e.vnewsType]=videoCtg[a];return t},setVideoWidthAndHeight:function(e){setTimeout(function(){e[0].width=e.width(),e[0].height=9*e[0].width/16},100),e.on("loadeddata",function(a){e[0].width=e.width(),e[0].height=9*e.width()/16})},addVideoListener:function(e){var a=this;e.on("playing",function(e){try{var t=$(e.target),s=t[0],i=s.currentSrc,n=Math.floor(1e3*s.duration),o=t.attr("data-idx"),r=t.attr("data-type"),l=t.attr("data-playingTime")?t.attr("data-playingTime"):"null",d=Math.floor(1e3*s.currentTime),c=a.qid+"	"+a.userId+"	news	eastday_wapnews	"+a.newsType+"	"+r+"	"+a.osType+"	"+o+"	"+a.browserType+"	"+i+"	"+n+"	"+l+"	"+d+"	play";t.attr("data-updateTime",+new Date),a.sendVideoLog(c)}catch(p){console.error("Event playing has error!!!",p)}}),e.on("pause",function(e){try{var t=$(e.target),s=t[0],i=s.currentSrc,n=Math.floor(1e3*s.duration),o=t.attr("data-idx"),r=t.attr("data-type"),l=t.attr("data-playingTime")?t.attr("data-playingTime"):"null",d=Math.floor(1e3*s.currentTime),c=a.qid+"	"+a.userId+"	news	eastday_wapnews	"+a.newsType+"	"+r+"	"+a.osType+"	"+o+"	"+a.browserType+"	"+i+"	"+n+"	"+l+"	"+d+"	pause";a.sendVideoLog(c)}catch(p){console.error("Event pause has error!!!",p)}}),e.on("timeupdate",function(e){try{var a=$(e.target),t=parseInt(a.attr("data-updateTime"),10)||+new Date,s=parseInt(a.attr("data-playingTime"),10)||0,i=+new Date;s=s+i-t,a.attr("data-playingTime",s),a.attr("data-updateTime",i)}catch(n){console.error("Event timeupdate has error!!!",n)}})},sendVideoLog:function(e){$.ajax({url:w,data:{param:e},dataType:"jsonp",jsonp:"jsonpcallback",success:function(){},error:function(){}})},setGgId:function(){try{baiduGgId=GLOBAL.Et.gg.baidu?GLOBAL.Et.gg.baidu.li:"",sogouGgId=GLOBAL.Et.gg.sogou?GLOBAL.Et.gg.sogou.li:"",gdtGgId=GLOBAL.Et.gg.gdt?GLOBAL.Et.gg.gdt.li:""}catch(e){console.error("setGgId has error: \n",e)}},loadVideoGg:function(e){var a=$('<div class="J-gg-video gg-video"><div class="gg"></div><a class="J-gg-close-video gg-close-video">关闭广告</a></div>'),t=document.createElement("div"),s=document.createElement("script"),i=document.createElement("script"),n="u2643659";t.id="bdUserDefInlay_"+n,s.type="text/javascript",s.innerHTML='var cpro_id = "'+n+'";',i.type="text/javascript",i.src="http://cpro.baidustatic.com/cpro/ui/cm.js",a.find(".gg").append(t).append(s).append(i),a.appendTo(e)},showGg:function(e){e.show(),e.prev().css({width:1,height:1})},hideGg:function(e){e.hide(),e.prev().css({width:"100%",height:"100%"})}},new e});